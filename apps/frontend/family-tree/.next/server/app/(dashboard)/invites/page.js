(()=>{var e={};e.id=24,e.ids=[24],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},36546:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>h,pages:()=>o,routeModule:()=>m,tree:()=>d}),s(52508),s(63901),s(12523);var a=s(23191),i=s(88716),r=s(37922),n=s.n(r),l=s(95231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);s.d(t,c);let d=["",{children:["(dashboard)",{children:["invites",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,52508)),"/mnt/win3/work/family_tree/apps/frontend/family-tree/src/app/(dashboard)/invites/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,63901)),"/mnt/win3/work/family_tree/apps/frontend/family-tree/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,12523)),"/mnt/win3/work/family_tree/apps/frontend/family-tree/src/app/not-found.tsx"]}],o=["/mnt/win3/work/family_tree/apps/frontend/family-tree/src/app/(dashboard)/invites/page.tsx"],h="/(dashboard)/invites/page",x={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(dashboard)/invites/page",pathname:"/invites",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8335:(e,t,s)=>{Promise.resolve().then(s.bind(s,68843))},98091:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},68843:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Z});var a=s(10326),i=s(17577),r=s(32082),n=s(35047),l=s(84097),c=s(91664),d=s(44794),o=s(29752),h=s(29280),x=s(51223);let m=i.forwardRef(({className:e,...t},s)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:s,className:(0,x.cn)("w-full caption-bottom text-sm",e),...t})}));m.displayName="Table";let p=i.forwardRef(({className:e,...t},s)=>a.jsx("thead",{ref:s,className:(0,x.cn)("[&_tr]:border-b",e),...t}));p.displayName="TableHeader";let u=i.forwardRef(({className:e,...t},s)=>a.jsx("tbody",{ref:s,className:(0,x.cn)("[&_tr:last-child]:border-0",e),...t}));u.displayName="TableBody",i.forwardRef(({className:e,...t},s)=>a.jsx("tfoot",{ref:s,className:(0,x.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let j=i.forwardRef(({className:e,...t},s)=>a.jsx("tr",{ref:s,className:(0,x.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));j.displayName="TableRow";let v=i.forwardRef(({className:e,...t},s)=>a.jsx("th",{ref:s,className:(0,x.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));v.displayName="TableHead";let f=i.forwardRef(({className:e,...t},s)=>a.jsx("td",{ref:s,className:(0,x.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));f.displayName="TableCell",i.forwardRef(({className:e,...t},s)=>a.jsx("caption",{ref:s,className:(0,x.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";var y=s(38443),g=s(28180),b=s(683),N=s(98023),w=s(76557);let k=(0,w.Z)("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),_=(0,w.Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),C=(0,w.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var P=s(92771),R=s(83855),S=s(5932);let z=(0,w.Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),E=(0,w.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var T=s(98091);function Z(){let{user:e}=(0,r.a)(),t=(0,n.useRouter)(),{toast:s}=(0,l.pm)(),[x,w]=(0,i.useState)([]),[Z,D]=(0,i.useState)([]),[M,I]=(0,i.useState)(""),[F,q]=(0,i.useState)(!1),[L,A]=(0,i.useState)(!1),{members:G}=(0,N.r)({treeId:M,autoFetch:!!M}),O=async e=>{q(!0);try{let t=await fetch(`http://localhost:8050/api/trees/${e}/invites`,{credentials:"include"});if(!t.ok)throw Error("Failed to fetch invites");let s=await t.json();D(s)}catch(e){console.error("Error fetching invites:",e),s({title:"Error",description:"Failed to load invitations. Please try again.",variant:"destructive"})}finally{q(!1)}},$=async(e,t)=>{if(t>=3){s({title:"Resend Limit Reached",description:"This invitation has reached the maximum resend limit (3). Please delete and create a new invitation.",variant:"destructive"});return}q(!0);try{let t=await fetch(`http://localhost:8050/api/invites/${e}/resend`,{method:"POST",credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.detail||"Failed to resend invite")}s({title:"Invite Resent! \uD83D\uDCE7",description:"Invitation has been resent."}),M&&O(M)}catch(e){s({title:"Error",description:e instanceof Error?e.message:"Failed to resend invitation.",variant:"destructive"})}finally{q(!1)}},H=async e=>{q(!0);try{if(!(await fetch(`http://localhost:8050/api/invites/${e}`,{method:"DELETE",credentials:"include"})).ok)throw Error("Failed to cancel invite");s({title:"Invite Canceled",description:"Invitation has been canceled."}),M&&O(M)}catch(e){s({title:"Error",description:"Failed to cancel invitation.",variant:"destructive"})}finally{q(!1)}},V=e=>{let t=`${window.location.origin}/invites/${e}`;navigator.clipboard.writeText(t),s({title:"Copied!",description:"Invite link copied to clipboard."})},B=e=>e.accepted_at?(0,a.jsxs)(y.C,{className:"bg-green-500",children:[a.jsx(k,{className:"w-3 h-3 mr-1"})," Accepted"]}):new Date(e.expires_at)<new Date?(0,a.jsxs)(y.C,{variant:"destructive",children:[a.jsx(_,{className:"w-3 h-3 mr-1"})," Expired"]}):(0,a.jsxs)(y.C,{variant:"secondary",children:[a.jsx(C,{className:"w-3 h-3 mr-1"})," Pending"]}),Y=e=>a.jsx(y.C,{className:{custodian:"bg-purple-500",contributor:"bg-blue-500",viewer:"bg-gray-500"}[e]||"bg-gray-500",children:e}),X=e=>!e.accepted_at&&new Date(e.expires_at)>new Date&&e.resend_count<3,Q=e=>{if(0===e.resend_count)return null;let t=3-e.resend_count;return 0===t?a.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Max resends reached"}):(0,a.jsxs)("span",{className:"text-xs text-amber-600",children:[e.resend_count,"/3 resends (",t," left)"]})};return 0===x.length?a.jsx(g.c,{children:a.jsx("div",{className:"space-y-6",children:(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[a.jsx(o.ll,{children:"No Trees Available"}),a.jsx(o.SZ,{children:"You need to be a custodian of at least one tree to manage invitations."})]}),a.jsx(o.aY,{children:(0,a.jsxs)(c.z,{onClick:()=>t.push("/trees"),children:[a.jsx(P.Z,{className:"h-4 w-4 mr-2"}),"Go to Trees"]})})]})})}):a.jsx(g.c,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Invitations"}),a.jsx("p",{className:"text-muted-foreground",children:"Manage invitations to your family trees"})]}),(0,a.jsxs)(c.z,{onClick:()=>{if(!M){s({title:"Select a Tree",description:"Please select a tree first to send invitations.",variant:"destructive"});return}A(!0)},disabled:!M,children:[a.jsx(R.Z,{className:"w-4 h-4 mr-2"}),"Send Invite"]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx(d._,{children:"Select Tree:"}),(0,a.jsxs)(h.Ph,{value:M,onValueChange:I,children:[a.jsx(h.i4,{className:"w-[300px]",children:a.jsx(h.ki,{placeholder:"Select a tree"})}),a.jsx(h.Bw,{children:x.map(e=>a.jsx(h.Ql,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[a.jsx(o.ll,{children:"Invitations"}),(0,a.jsxs)(o.SZ,{children:[Z.length," invitation",1!==Z.length?"s":""," for this tree"]})]}),a.jsx(o.aY,{children:F?a.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading invitations..."}):0===Z.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[a.jsx(S.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No invitations sent yet"}),a.jsx("p",{className:"text-sm",children:"Send your first invitation to get started"})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block",children:(0,a.jsxs)(m,{children:[a.jsx(p,{children:(0,a.jsxs)(j,{children:[a.jsx(v,{children:"Email"}),a.jsx(v,{children:"Role"}),a.jsx(v,{children:"Status"}),a.jsx(v,{children:"Resends"}),a.jsx(v,{children:"Sent By"}),a.jsx(v,{children:"Created"}),a.jsx(v,{className:"text-right",children:"Actions"})]})}),a.jsx(u,{children:Z.map(e=>(0,a.jsxs)(j,{children:[a.jsx(f,{className:"font-medium",children:e.email}),a.jsx(f,{children:Y(e.role)}),a.jsx(f,{children:B(e)}),a.jsx(f,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("span",{className:"text-sm",children:[e.resend_count,"/3"]}),Q(e)]})}),a.jsx(f,{children:e.created_by_name}),a.jsx(f,{children:new Date(e.created_at).toLocaleDateString()}),a.jsx(f,{className:"text-right",children:a.jsx("div",{className:"flex items-center justify-end gap-2",children:!e.accepted_at&&new Date(e.expires_at)>new Date&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.z,{variant:"ghost",size:"sm",onClick:()=>V(e.token),title:"Copy invite link",className:"hover:bg-blue-50",children:[a.jsx(z,{className:"w-4 h-4"}),a.jsx("span",{className:"sr-only",children:"Copy invite link"})]}),(0,a.jsxs)(c.z,{variant:"ghost",size:"sm",onClick:()=>$(e.token,e.resend_count),title:X(e)?"Resend invitation":"Maximum resends reached",className:"hover:bg-green-50",disabled:!X(e),children:[a.jsx(E,{className:"w-4 h-4"}),a.jsx("span",{className:"sr-only",children:"Resend invitation"})]}),(0,a.jsxs)(c.z,{variant:"ghost",size:"sm",onClick:()=>H(e.token),title:"Cancel invitation",className:"hover:bg-red-50",children:[a.jsx(T.Z,{className:"w-4 h-4"}),a.jsx("span",{className:"sr-only",children:"Cancel invitation"})]})]})})})]},e.id))})]})}),a.jsx("div",{className:"md:hidden space-y-4",children:Z.map(e=>a.jsx(o.Zb,{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-medium truncate",children:e.email}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[Y(e.role),B(e)]})]})}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsxs)("p",{children:["Sent by: ",e.created_by_name]}),(0,a.jsxs)("p",{children:["Created:"," ",new Date(e.created_at).toLocaleDateString()]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{children:["Resends: ",e.resend_count,"/3"]}),Q(e)]})]}),!e.accepted_at&&new Date(e.expires_at)>new Date&&(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>V(e.token),className:"flex-1",children:[a.jsx(z,{className:"w-4 h-4 mr-2"}),"Copy Link"]}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>$(e.token,e.resend_count),disabled:!X(e),className:"flex-1",children:[a.jsx(E,{className:"w-4 h-4 mr-2"}),"Resend"]}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>H(e.token),className:"flex-1",children:[a.jsx(T.Z,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})},e.id))})]})})]})]}),a.jsx(b.y,{open:L,onOpenChange:A,treeId:M,members:M?G:[],onInviteSent:()=>{A(!1),M&&O(M)}})]})})}},52508:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(68570).createProxy)(String.raw`/mnt/win3/work/family_tree/apps/frontend/family-tree/src/app/(dashboard)/invites/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[990,153,882,752,711,204],()=>s(36546));module.exports=a})();