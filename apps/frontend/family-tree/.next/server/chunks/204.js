"use strict";exports.id=204,exports.ids=[204],exports.modules={83855:(e,a,s)=>{s.d(a,{Z:()=>t});let t=(0,s(76557).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},683:(e,a,s)=>{s.d(a,{y:()=>h});var t=s(10326),l=s(17577),r=s(24118),i=s(29280),d=s(43870),n=s(91664),o=s(41190),c=s(44794),m=s(84097),u=s(5932),p=s(75290);function h({open:e,onOpenChange:a,treeId:s,members:h,onInviteSent:f}){let[x,b]=(0,l.useState)(""),[j,g]=(0,l.useState)(""),[v,y]=(0,l.useState)(""),[w,N]=(0,l.useState)(!1),{toast:_}=(0,m.pm)(),C=h.find(e=>e.id===x),S=C?.email&&""!==C.email.trim(),I=async()=>{if(!C||!j){_({title:"Missing Information",description:"Please select a member and role.",variant:"destructive"});return}let e=S?C.email:v.trim();if(!e){_({title:"Email Required",description:"Please provide an email address for the invitation.",variant:"destructive"});return}try{if(N(!0),!S&&v.trim()){let e=await fetch(`http://localhost:8050/api/members/${C.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:v.trim()})});if(!e.ok){if(400===e.status){let a=await e.json();throw Error(a.detail||"The email you&apos;ve provided is either a duplicate or invalid.")}throw Error("Failed to update member email. A")}}let a=await fetch("http://localhost:8050/api/invites",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({tree_id:s,member_id:C.id,email:e,role:j})});if(!a.ok){let e=await a.json();throw Error(e.detail||"Failed to send invite")}_({title:"Invite Sent",description:`Invitation sent to ${e} successfully.`}),b(""),g(""),y(""),f()}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to send invite",variant:"destructive"})}finally{N(!1)}};return t.jsx(r.Vq,{open:e,onOpenChange:a,children:(0,t.jsxs)(r.cZ,{className:"max-w-md",children:[(0,t.jsxs)(r.fK,{children:[(0,t.jsxs)(r.$N,{className:"flex items-center gap-2",children:[t.jsx(u.Z,{className:"h-5 w-5"}),"Send Invitation"]}),t.jsx(r.Be,{children:"Send an invitation to a family member to join this tree."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Select Member"}),t.jsx(d.V,{id:"member-select",value:x,onValueChange:e=>{b(e),y("")},placeholder:"Choose a family member",searchPlaceholder:"Search family members...",options:h.map(e=>({value:e.id,label:`${e.name}${e.email?" ✓":""}`}))}),C&&t.jsx("p",{className:"text-xs text-muted-foreground",children:C.email?t.jsx("span",{className:"text-green-600",children:"✓ Email configured"}):t.jsx("span",{className:"text-amber-600",children:"⚠ No email - will be added below"})})]}),C&&(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Email Address"}),S?(0,t.jsxs)("div",{className:"p-3 bg-muted rounded-md",children:[t.jsx("p",{className:"text-sm font-medium",children:C.email}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Email already configured for this member"})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(o.I,{type:"email",placeholder:"Enter email address",value:v,onChange:e=>y(e.target.value)}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"This email will be saved to the member's profile"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Role"}),(0,t.jsxs)(i.Ph,{value:j,onValueChange:g,children:[t.jsx(i.i4,{children:t.jsx(i.ki,{placeholder:"Select role"})}),(0,t.jsxs)(i.Bw,{children:[t.jsx(i.Ql,{value:"viewer",children:(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-medium",children:"Viewer"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Can view the tree but not make changes"})]})}),t.jsx(i.Ql,{value:"contributor",children:(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-medium",children:"Contributor"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Can add and edit family members"})]})}),t.jsx(i.Ql,{value:"custodian",children:(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-medium",children:"Custodian"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Full access including invites and settings"})]})})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-4",children:[t.jsx(n.z,{variant:"outline",onClick:()=>a(!1),className:"flex-1",children:"Cancel"}),t.jsx(n.z,{onClick:I,disabled:w||!C||!j,className:"flex-1",children:w?(0,t.jsxs)(t.Fragment,{children:[t.jsx(p.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx(u.Z,{className:"h-4 w-4 mr-2"}),"Send Invite"]})})]})]})]})})}},41190:(e,a,s)=>{s.d(a,{I:()=>i});var t=s(10326),l=s(17577),r=s(51223);let i=l.forwardRef(({className:e,type:a,...s},l)=>t.jsx("input",{type:a,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:l,...s}));i.displayName="Input"},44794:(e,a,s)=>{s.d(a,{_:()=>o});var t=s(10326),l=s(17577),r=s(34478),i=s(79360),d=s(51223);let n=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=l.forwardRef(({className:e,...a},s)=>t.jsx(r.f,{ref:s,className:(0,d.cn)(n(),e),...a}));o.displayName=r.f.displayName},43870:(e,a,s)=>{s.d(a,{V:()=>i});var t=s(10326),l=s(17577),r=s(29280);function i({value:e,onValueChange:a,placeholder:s="Select an option...",searchPlaceholder:i="Search options...",options:d,className:n,disabled:o,id:c}){let[m,u]=l.useState(""),[p,h]=l.useState(!1),f=l.useMemo(()=>{let e=d;return m&&(e=d.filter(e=>e.label.toLowerCase().includes(m.toLowerCase())||e.value.toLowerCase().includes(m.toLowerCase()))),e.sort((e,a)=>e.label.localeCompare(a.label))},[d,m]);return(0,t.jsxs)(r.Ph,{value:e,onValueChange:e=>{console.log(`SearchableSelect ${c||"unknown"} value changed to:`,e),u(""),h(!1),a?.(e)},disabled:o,open:p,onOpenChange:e=>{h(e),e||u("")},children:[t.jsx(r.i4,{className:n,children:t.jsx(r.ki,{placeholder:s})}),t.jsx(r.Bw,{searchable:!0,searchPlaceholder:i,onSearchChange:e=>{u(e)},children:0===f.length?t.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"No options found."}):f.map(e=>t.jsx(r.Ql,{value:e.value,disabled:e.disabled,children:e.label},e.value))})]})}},29280:(e,a,s)=>{s.d(a,{Bw:()=>x,Ph:()=>m,Ql:()=>b,i4:()=>p,ki:()=>u});var t=s(10326),l=s(17577),r=s(18792),i=s(941),d=s(96633),n=s(88307),o=s(32933),c=s(51223);s(43870);let m=r.fC;r.ZA;let u=r.B4,p=l.forwardRef(({className:e,children:a,...s},l)=>(0,t.jsxs)(r.xz,{ref:l,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[a,t.jsx(r.JO,{asChild:!0,children:t.jsx(i.Z,{className:"h-4 w-4 opacity-50"})})]}));p.displayName=r.xz.displayName;let h=l.forwardRef(({className:e,...a},s)=>t.jsx(r.u_,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...a,children:t.jsx(d.Z,{className:"h-4 w-4"})}));h.displayName=r.u_.displayName;let f=l.forwardRef(({className:e,...a},s)=>t.jsx(r.$G,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...a,children:t.jsx(i.Z,{className:"h-4 w-4"})}));f.displayName=r.$G.displayName;let x=l.forwardRef(({className:e,children:a,position:s="popper",searchable:i=!1,searchPlaceholder:d="Search...",onSearchChange:o,...m},u)=>{let[p,x]=l.useState("");return t.jsx(r.h_,{children:(0,t.jsxs)(r.VY,{ref:u,className:(0,c.cn)("relative z-[999999] max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...m,children:[t.jsx(h,{}),i&&(0,t.jsxs)("div",{className:"flex items-center border-b px-3 py-2",children:[t.jsx(n.Z,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),t.jsx("input",{className:"flex h-8 w-full rounded-md bg-transparent py-1 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",placeholder:d,value:p,onChange:e=>{let a=e.target.value;x(a),o?.(a)},onClick:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation()})]}),t.jsx(r.l_,{className:(0,c.cn)("p-1",i&&"overflow-y-auto max-h-[200px]","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),t.jsx(f,{})]})})});x.displayName=r.VY.displayName,l.forwardRef(({className:e,...a},s)=>t.jsx(r.__,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...a})).displayName=r.__.displayName;let b=l.forwardRef(({className:e,children:a,...s},l)=>(0,t.jsxs)(r.ck,{ref:l,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(r.wU,{children:t.jsx(o.Z,{className:"h-4 w-4"})})}),t.jsx(r.eT,{children:a})]}));b.displayName=r.ck.displayName,l.forwardRef(({className:e,...a},s)=>t.jsx(r.Z0,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",e),...a})).displayName=r.Z0.displayName},98023:(e,a,s)=>{s.d(a,{r:()=>l});var t=s(17577);function l({treeId:e,autoFetch:a=!0}){let[s,l]=(0,t.useState)([]),[r,i]=(0,t.useState)(!1),[d,n]=(0,t.useState)(null),o=(e,a)=>{let s=new Map;return e.forEach(e=>{s.set(e.id,{...e,spouseIds:[],parentIds:[],childIds:[]})}),a.forEach(e=>{let a=s.get(e.a_member_id),t=s.get(e.b_member_id);a&&t&&("spouse"===e.type?(a.spouseIds.includes(e.b_member_id)||a.spouseIds.push(e.b_member_id),t.spouseIds.includes(e.a_member_id)||t.spouseIds.push(e.a_member_id)):"parent-child"!==e.type||(a.childIds.includes(e.b_member_id)||a.childIds.push(e.b_member_id),t.parentIds.includes(e.a_member_id)||t.parentIds.push(e.a_member_id)))}),Array.from(s.values())},c=(0,t.useCallback)(async()=>{if(e){i(!0),n(null);try{let a;let s="http://localhost:8050/api",t=[],r=!0;for(;r;){let l=a?`${s}/trees/${e}/members?limit=200&after=${a}`:`${s}/trees/${e}/members?limit=200`,i=await fetch(l,{credentials:"include"});if(!i.ok)throw Error(`Failed to fetch members: ${i.statusText}`);let d=await i.json(),n=d.items||d;t=[...t,...n],r=!!(a=d.next)&&n.length>0}let i=await fetch(`${s}/trees/${e}/relationships`,{credentials:"include"});if(!i.ok)throw Error(`Failed to fetch relationships: ${i.statusText}`);let d=await i.json();console.log("[useTreeMembers] Fetched data:",{memberCount:t.length,relationshipCount:d.length,relationships:d,members:t.map(e=>({id:e.id,name:e.name}))});let n=o(t,d);console.log("[useTreeMembers] Built tree members:",{treeMembers:n.map(e=>({id:e.id,name:e.name,parentIds:e.parentIds,childIds:e.childIds,spouseIds:e.spouseIds}))}),l(n)}catch(e){n(e instanceof Error?e:Error("Unknown error")),console.error("Error fetching tree members:",e)}finally{i(!1)}}},[e]),m=(0,t.useCallback)(e=>s.find(a=>a.id===e),[s]),u=(0,t.useCallback)(()=>s.filter(e=>0===e.parentIds.length),[s]);return{members:s,loading:r,error:d,refetch:c,getMemberById:m,getRootMembers:u}}},34478:(e,a,s)=>{s.d(a,{f:()=>d});var t=s(17577),l=s(45226),r=s(10326),i=t.forwardRef((e,a)=>(0,r.jsx)(l.WV.label,{...e,ref:a,onMouseDown:a=>{a.target.closest("button, input, select, textarea")||(e.onMouseDown?.(a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));i.displayName="Label";var d=i}};