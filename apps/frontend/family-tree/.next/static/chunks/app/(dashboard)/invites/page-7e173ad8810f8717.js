(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6024],{44408:function(e,t,s){Promise.resolve().then(s.bind(s,79493))},79493:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return T}});var a=s(57437),n=s(2265),r=s(50828),i=s(99376),l=s(23340),c=s(12381),d=s(75060),o=s(79820),h=s(15291),x=s(93448);let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,x.cn)("w-full caption-bottom text-sm",s),...n})})});m.displayName="Table";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("thead",{ref:t,className:(0,x.cn)("[&_tr]:border-b",s),...n})});u.displayName="TableHeader";let f=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,x.cn)("[&_tr:last-child]:border-0",s),...n})});f.displayName="TableBody",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,x.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...n})}).displayName="TableFooter";let j=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("tr",{ref:t,className:(0,x.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...n})});j.displayName="TableRow";let v=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("th",{ref:t,className:(0,x.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...n})});v.displayName="TableHead";let p=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("td",{ref:t,className:(0,x.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...n})});p.displayName="TableCell",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("caption",{ref:t,className:(0,x.cn)("mt-4 text-sm text-muted-foreground",s),...n})}).displayName="TableCaption";var N=s(69174),g=s(86271),b=s(4909),y=s(37511),w=s(66901),k=s(45131),_=s(91723),C=s(53057),E=s(99397),R=s(89345),S=s(78867),Z=s(82431),D=s(18930);function T(){let{user:e}=(0,r.a)(),t=(0,i.useRouter)(),{toast:s}=(0,l.pm)(),[x,T]=(0,n.useState)([]),[z,F]=(0,n.useState)([]),[I,P]=(0,n.useState)(""),[L,O]=(0,n.useState)(!1),[A,B]=(0,n.useState)(!1),{members:M}=(0,y.r)({treeId:I,autoFetch:!!I});(0,n.useEffect)(()=>{if(!e){t.push("/");return}Y()},[e]),(0,n.useEffect)(()=>{I&&H(I)},[I]);let Y=async()=>{try{let e=await fetch("".concat("http://localhost:8050/api","/trees"),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch trees");let t=(await e.json()).filter(e=>"custodian"===e.role);T(t),t.length>0&&!I&&P(t[0].id)}catch(e){console.error("Error fetching trees:",e),s({title:"Error",description:"Failed to load your trees. Please try again.",variant:"destructive"})}},H=async e=>{O(!0);try{let t=await fetch("".concat("http://localhost:8050/api","/trees/").concat(e,"/invites"),{credentials:"include"});if(!t.ok)throw Error("Failed to fetch invites");let s=await t.json();F(s)}catch(e){console.error("Error fetching invites:",e),s({title:"Error",description:"Failed to load invitations. Please try again.",variant:"destructive"})}finally{O(!1)}},V=async(e,t)=>{if(t>=3){s({title:"Resend Limit Reached",description:"This invitation has reached the maximum resend limit (3). Please delete and create a new invitation.",variant:"destructive"});return}O(!0);try{let t=await fetch("".concat("http://localhost:8050/api","/invites/").concat(e,"/resend"),{method:"POST",credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.detail||"Failed to resend invite")}s({title:"Invite Resent! \uD83D\uDCE7",description:"Invitation has been resent."}),I&&H(I)}catch(e){s({title:"Error",description:e instanceof Error?e.message:"Failed to resend invitation.",variant:"destructive"})}finally{O(!1)}},G=async e=>{O(!0);try{if(!(await fetch("".concat("http://localhost:8050/api","/invites/").concat(e),{method:"DELETE",credentials:"include"})).ok)throw Error("Failed to cancel invite");s({title:"Invite Canceled",description:"Invitation has been canceled."}),I&&H(I)}catch(e){s({title:"Error",description:"Failed to cancel invitation.",variant:"destructive"})}finally{O(!1)}},Q=e=>{let t="".concat(window.location.origin,"/invites/").concat(e);navigator.clipboard.writeText(t),s({title:"Copied!",description:"Invite link copied to clipboard."})},q=e=>e.accepted_at?(0,a.jsxs)(N.C,{className:"bg-green-500",children:[(0,a.jsx)(w.Z,{className:"w-3 h-3 mr-1"})," Accepted"]}):new Date(e.expires_at)<new Date?(0,a.jsxs)(N.C,{variant:"destructive",children:[(0,a.jsx)(k.Z,{className:"w-3 h-3 mr-1"})," Expired"]}):(0,a.jsxs)(N.C,{variant:"secondary",children:[(0,a.jsx)(_.Z,{className:"w-3 h-3 mr-1"})," Pending"]}),J=e=>(0,a.jsx)(N.C,{className:{custodian:"bg-purple-500",contributor:"bg-blue-500",viewer:"bg-gray-500"}[e]||"bg-gray-500",children:e}),K=e=>!e.accepted_at&&new Date(e.expires_at)>new Date&&e.resend_count<3,U=e=>{if(0===e.resend_count)return null;let t=3-e.resend_count;return 0===t?(0,a.jsx)("span",{className:"text-xs text-red-600 font-medium",children:"Max resends reached"}):(0,a.jsxs)("span",{className:"text-xs text-amber-600",children:[e.resend_count,"/3 resends (",t," left)"]})};return 0===x.length?(0,a.jsx)(g.c,{children:(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[(0,a.jsx)(o.ll,{children:"No Trees Available"}),(0,a.jsx)(o.SZ,{children:"You need to be a custodian of at least one tree to manage invitations."})]}),(0,a.jsx)(o.aY,{children:(0,a.jsxs)(c.z,{onClick:()=>t.push("/trees"),children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 mr-2"}),"Go to Trees"]})})]})})}):(0,a.jsx)(g.c,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Invitations"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage invitations to your family trees"})]}),(0,a.jsxs)(c.z,{onClick:()=>{if(!I){s({title:"Select a Tree",description:"Please select a tree first to send invitations.",variant:"destructive"});return}B(!0)},disabled:!I,children:[(0,a.jsx)(E.Z,{className:"w-4 h-4 mr-2"}),"Send Invite"]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(d._,{children:"Select Tree:"}),(0,a.jsxs)(h.Ph,{value:I,onValueChange:P,children:[(0,a.jsx)(h.i4,{className:"w-[300px]",children:(0,a.jsx)(h.ki,{placeholder:"Select a tree"})}),(0,a.jsx)(h.Bw,{children:x.map(e=>(0,a.jsx)(h.Ql,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[(0,a.jsx)(o.ll,{children:"Invitations"}),(0,a.jsxs)(o.SZ,{children:[z.length," invitation",1!==z.length?"s":""," for this tree"]})]}),(0,a.jsx)(o.aY,{children:L?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading invitations..."}):0===z.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(R.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"No invitations sent yet"}),(0,a.jsx)("p",{className:"text-sm",children:"Send your first invitation to get started"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"hidden md:block",children:(0,a.jsxs)(m,{children:[(0,a.jsx)(u,{children:(0,a.jsxs)(j,{children:[(0,a.jsx)(v,{children:"Email"}),(0,a.jsx)(v,{children:"Role"}),(0,a.jsx)(v,{children:"Status"}),(0,a.jsx)(v,{children:"Resends"}),(0,a.jsx)(v,{children:"Sent By"}),(0,a.jsx)(v,{children:"Created"}),(0,a.jsx)(v,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(f,{children:z.map(e=>(0,a.jsxs)(j,{children:[(0,a.jsx)(p,{className:"font-medium",children:e.email}),(0,a.jsx)(p,{children:J(e.role)}),(0,a.jsx)(p,{children:q(e)}),(0,a.jsx)(p,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("span",{className:"text-sm",children:[e.resend_count,"/3"]}),U(e)]})}),(0,a.jsx)(p,{children:e.created_by_name}),(0,a.jsx)(p,{children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)(p,{className:"text-right",children:(0,a.jsx)("div",{className:"flex items-center justify-end gap-2",children:!e.accepted_at&&new Date(e.expires_at)>new Date&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.z,{variant:"ghost",size:"sm",onClick:()=>Q(e.token),title:"Copy invite link",className:"hover:bg-blue-50",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Copy invite link"})]}),(0,a.jsxs)(c.z,{variant:"ghost",size:"sm",onClick:()=>V(e.token,e.resend_count),title:K(e)?"Resend invitation":"Maximum resends reached",className:"hover:bg-green-50",disabled:!K(e),children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Resend invitation"})]}),(0,a.jsxs)(c.z,{variant:"ghost",size:"sm",onClick:()=>G(e.token),title:"Cancel invitation",className:"hover:bg-red-50",children:[(0,a.jsx)(D.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Cancel invitation"})]})]})})})]},e.id))})]})}),(0,a.jsx)("div",{className:"md:hidden space-y-4",children:z.map(e=>(0,a.jsx)(o.Zb,{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium truncate",children:e.email}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[J(e.role),q(e)]})]})}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsxs)("p",{children:["Sent by: ",e.created_by_name]}),(0,a.jsxs)("p",{children:["Created:"," ",new Date(e.created_at).toLocaleDateString()]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{children:["Resends: ",e.resend_count,"/3"]}),U(e)]})]}),!e.accepted_at&&new Date(e.expires_at)>new Date&&(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>Q(e.token),className:"flex-1",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 mr-2"}),"Copy Link"]}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>V(e.token,e.resend_count),disabled:!K(e),className:"flex-1",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-2"}),"Resend"]}),(0,a.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>G(e.token),className:"flex-1",children:[(0,a.jsx)(D.Z,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})},e.id))})]})})]})]}),(0,a.jsx)(b.y,{open:A,onOpenChange:B,treeId:I,members:I?M:[],onInviteSent:()=>{B(!1),I&&H(I)}})]})})}},69174:function(e,t,s){"use strict";s.d(t,{C:function(){return l}});var a=s(57437);s(2265);var n=s(90535),r=s(93448);let i=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:s,...n}=e;return(0,a.jsx)("div",{className:(0,r.cn)(i({variant:s}),t),...n})}}},function(e){e.O(0,[7697,1770,7203,4360,8269,576,4713,7308,623,2971,2117,1744],function(){return e(e.s=44408)}),_N_E=e.O()}]);