(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{44542:function(e,t,n){Promise.resolve().then(n.bind(n,54136))},54136:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eg}});var a=n(57437),s=n(2265),r=n(99376),i=n(12381),l=n(79820),o=n(69174),c=n(17168),d=n(96246),m=n(86271),u=n(23340),h=n(88997),p=n(36498),g=n(61994),x=n(40257);let f=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),v=e=>{if(!e)return"bg-gray-400";let t=e.toLowerCase();return"male"===t?"bg-blue-400":"female"===t?"bg-pink-400":"bg-purple-400"};function j(e){let{member:t,isSelected:n,isHighlighted:r,onClick:i}=e,o=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!o.current)return;p.p8.fromTo(o.current,{opacity:0,scale:.8,y:20},{opacity:1,scale:1,y:0,duration:.6,ease:"back.out(1.7)",delay:.3*Math.random()});let e=()=>{p.p8.to(o.current,{scale:1.05,y:-2,duration:.3,ease:"power2.out"})},t=()=>{p.p8.to(o.current,{scale:1,y:0,duration:.3,ease:"power2.out"})},n=o.current;return n.addEventListener("mouseenter",e),n.addEventListener("mouseleave",t),()=>{n.removeEventListener("mouseenter",e),n.removeEventListener("mouseleave",t)}},[]),(0,s.useEffect)(()=>{o.current&&(n?p.p8.to(o.current,{scale:1.08,duration:.3,ease:"power2.out"}):p.p8.to(o.current,{scale:1,duration:.3,ease:"power2.out"}))},[n]),(0,a.jsx)("div",{className:"relative inline-block",style:{zIndex:10},children:(0,a.jsx)(l.Zb,{ref:o,className:(0,g.Z)("min-w-[100px] cursor-pointer transition-all hover:shadow-lg bg-white dark:bg-slate-800",n&&"ring-2 ring-blue-500 ring-offset-2",r&&"ring-2 ring-yellow-400 ring-offset-2",t.deceased&&"opacity-75"),onClick:e=>null==i?void 0:i(e),children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 p-3",children:[(0,a.jsxs)(d.qE,{className:"h-14 w-14",children:[(0,a.jsx)(d.F$,{src:t.avatar_url?"".concat(x.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:8050").concat(t.avatar_url):void 0,alt:t.name}),(0,a.jsx)(d.Q5,{className:v(t.gender),children:f(t.name)})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:(0,g.Z)("text-sm font-medium leading-tight",t.deceased&&"line-through"),children:t.name}),t.dob&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["b. ",new Date(t.dob).getFullYear()]}),t.deceased&&t.dod&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["d. ",new Date(t.dod).getFullYear()]})]})]})})})}function b(e){let{member:t,spouses:n,isSelected:r,isHighlighted:i,onClick:o,onMemberClick:c,selectedMemberId:m}=e,u=(0,s.useRef)(null),b=(0,s.useRef)([]);return((0,s.useEffect)(()=>{if(!u.current||0===n.length)return;p.p8.fromTo(u.current,{opacity:0,scale:.9,y:15},{opacity:1,scale:1,y:0,duration:.7,ease:"back.out(1.4)",delay:.4*Math.random()}),b.current.forEach((e,t)=>{e&&(p.p8.fromTo(e,{scale:0,rotation:-180},{scale:1,rotation:0,duration:.5,ease:"back.out(2)",delay:.3+.1*t}),p.p8.to(e,{scale:1.1,duration:2,ease:"power2.inOut",yoyo:!0,repeat:-1,delay:1+.2*t}))});let e=()=>{p.p8.to(u.current,{scale:1.02,y:-1,duration:.3,ease:"power2.out"})},t=()=>{p.p8.to(u.current,{scale:1,y:0,duration:.3,ease:"power2.out"})},a=u.current;return a.addEventListener("mouseenter",e),a.addEventListener("mouseleave",t),()=>{a.removeEventListener("mouseenter",e),a.removeEventListener("mouseleave",t)}},[n.length]),0===n.length)?(0,a.jsx)(j,{member:t,isSelected:r,isHighlighted:i,onClick:o}):(0,a.jsx)(l.Zb,{ref:u,className:"inline-block border-2 p-2 bg-white dark:bg-slate-800",style:{zIndex:10},children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:(0,g.Z)("cursor-pointer rounded-lg p-2 transition-all hover:bg-accent",r&&"ring-2 ring-blue-500",i&&"ring-2 ring-yellow-400"),onClick:e=>null==o?void 0:o(e),children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsxs)(d.qE,{className:"h-14 w-14",children:[(0,a.jsx)(d.F$,{src:t.avatar_url?"".concat(x.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:8050").concat(t.avatar_url):void 0,alt:t.name}),(0,a.jsx)(d.Q5,{className:v(t.gender),children:f(t.name)})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:(0,g.Z)("text-sm font-medium leading-tight",t.deceased&&"line-through"),children:t.name}),t.dob&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["b. ",new Date(t.dob).getFullYear()]})]})]})}),n.length>0&&(0,a.jsx)("div",{ref:e=>{b.current[0]=e},children:(0,a.jsx)(h.Z,{className:"h-4 w-4 flex-shrink-0 fill-red-400 text-red-400"})}),n.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:(0,g.Z)("cursor-pointer rounded-lg p-2 transition-all hover:bg-accent",m===e.id&&"ring-2 ring-blue-500",i&&"ring-2 ring-yellow-400"),onClick:t=>{t.stopPropagation(),c?c(e):o&&o(t)},children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsxs)(d.qE,{className:"h-14 w-14",children:[(0,a.jsx)(d.F$,{src:e.avatar_url?"".concat(x.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:8050").concat(e.avatar_url):void 0,alt:e.name}),(0,a.jsx)(d.Q5,{className:v(e.gender),children:f(e.name)})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:(0,g.Z)("text-sm font-medium leading-tight",e.deceased&&"line-through"),children:e.name}),e.dob&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["b. ",new Date(e.dob).getFullYear()]})]})]})}),t<n.length-1&&(0,a.jsx)("div",{ref:e=>{b.current[t+1]=e},children:(0,a.jsx)(h.Z,{className:"h-4 w-4 flex-shrink-0 fill-red-400 text-red-400"})})]},e.id))]})})}function y(e){let{parentNode:t,childNode:n,isHighlighted:r,isSelected:i,onRelationshipAnalyze:l,onConnectionHighlight:o}=e,[c,d]=(0,s.useState)(0),[m,u]=(0,s.useState)(null),h="#00c71b",p=2.5,g=!1;i?(h="#3b82f6",p=3.5,g=!0):r&&(h="#f59e0b",p=4,g=!0);let x=(0,s.useCallback)(e=>{e.stopPropagation(),m&&clearTimeout(m);let a=c+1;d(a);let s="".concat(t.member.id,"-").concat(n.member.id);2===a?(console.log("[TreeEdges] \uD83D\uDD06 Double-clicked connector: ".concat(t.member.name," -> ").concat(n.member.name)),null==o||o(s),u(setTimeout(()=>d(0),1e3))):3===a?(console.log("[TreeEdges] \uD83D\uDD0D Triple-clicked connector: ".concat(t.member.name," -> ").concat(n.member.name)),null==l||l(t.member.id,n.member.id),d(0),m&&(clearTimeout(m),u(null))):1===a?u(setTimeout(()=>d(0),400)):(d(0),m&&(clearTimeout(m),u(null)))},[c,m,t.member.id,n.member.id,t.member.name,n.member.name,l,o]),f=t.x,v=t.y+60-8,j=n.x,b=n.y-60+8;if(v>=b)return console.error("[BezierConnector] Invalid parent-child positioning:",{parent:{name:t.member.name,y:t.y,bottomY:v},child:{name:n.member.name,y:n.y,topY:b}}),null;let y=Math.abs(j-f),w=Math.max(.4*(b-v),50),C=Math.min(.2*y,80),N=f+(y>100?j>f?C:-C:0),E=v+w,k=j-(y>100?j>f?C:-C:0),D=b-w,S="M ".concat(f," ").concat(v," C ").concat(N," ").concat(E,", ").concat(k," ").concat(D,", ").concat(j," ").concat(b),I=Math.min(f,j,N,k)-20,M=Math.max(f,j,N,k)+20,P=Math.min(v,b,E,D)-20,A=Math.max(v,b,E,D)+20;return(0,a.jsxs)("svg",{className:"absolute cursor-pointer",style:{left:"".concat(I,"px"),top:"".concat(P,"px"),width:"".concat(M-I,"px"),height:"".concat(A-P,"px"),zIndex:1},onClick:x,children:[(0,a.jsx)("path",{d:S,stroke:"transparent",strokeWidth:p+8,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(".concat(-I,", ").concat(-P,")"),style:{pointerEvents:"all"}}),g&&(0,a.jsx)("path",{d:S,stroke:h,strokeWidth:p+2,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(".concat(-I,", ").concat(-P,")"),style:{pointerEvents:"none",opacity:.3,filter:"blur(2px)"}}),(0,a.jsx)("path",{d:S,stroke:h,strokeWidth:p,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(".concat(-I,", ").concat(-P,")"),style:{pointerEvents:"none",transition:"stroke 0.2s ease, stroke-width 0.2s ease",filter:g?"drop-shadow(0 0 4px rgba(245, 158, 11, 0.5))":"none"}})]})}function w(e){let{parentNodes:t,childNodes:n,isHighlighted:s,selectedConnections:r,highlightedConnection:i,onRelationshipAnalyze:l,onConnectionHighlight:o}=e;if(0===t.length||0===n.length)return null;let c=[];return t.forEach(e=>{n.forEach(t=>{let n="".concat(e.member.id,"-").concat(t.member.id),d=(null==r?void 0:r.has(n))||!1,m=i===n;c.push((0,a.jsx)(y,{parentNode:e,childNode:t,isHighlighted:s||m,isSelected:d,onRelationshipAnalyze:l,onConnectionHighlight:o},n))})}),(0,a.jsx)(a.Fragment,{children:c})}function C(e){let{nodes:t,highlightPath:n=[],onRelationshipAnalyze:r,onConnectionHighlight:i}=e,[l]=(0,s.useState)(new Set),[o,c]=(0,s.useState)(null),d=[],m=(0,s.useCallback)((e,t)=>{null==r||r(e,t)},[r]),u=(0,s.useCallback)(e=>{c(t=>t===e?null:e),console.log("[TreeEdges] \uD83D\uDD06 Highlighted connection: ".concat(e)),null==i||i(e)},[i]),h=new Map;return t.forEach(e=>{let t=e.member;if(t.parentIds.length>0){let e=[...t.parentIds].sort().join("|");h.has(e)||h.set(e,[]),h.get(e).push(t.id)}e.spouses.forEach(e=>{if(e.parentIds.length>0){let t=[...e.parentIds].sort().join("|");h.has(t)||h.set(t,[]),h.get(t).push(e.id)}})}),console.log("[TreeEdges] Parent-child groupings with generations:",{nodeCount:t.length,parentGroups:Array.from(h.entries()).map(e=>{let[n,a]=e,s=n.split("|").map(e=>t.find(t=>t.member.id===e)),r=a.map(e=>t.find(t=>t.member.id===e));return{parentKey:n,parents:s.map(e=>({name:(null==e?void 0:e.member.name)||"unknown",gen:null==e?void 0:e.generation,y:null==e?void 0:e.y})),children:r.map(e=>({name:(null==e?void 0:e.member.name)||"unknown",gen:null==e?void 0:e.generation,y:null==e?void 0:e.y})),childCount:a.length}})}),h.forEach((e,s)=>{let r=s.split("|"),i=r.map(e=>t.find(t=>t.member.id===e)).filter(e=>void 0!==e),c=e.map(e=>{let n=t.find(t=>t.member.id===e);if(n)return n;let a=t.find(t=>t.spouses.some(t=>t.id===e));if(a)return{member:a.spouses.find(t=>t.id===e),x:a.x,y:a.y,generation:a.generation,spouses:[],familyUnitId:a.familyUnitId}}).filter(e=>void 0!==e);if(0===i.length||0===c.length)return;let h=i.reduce((e,t)=>e+t.y,0)/i.length,p=c.reduce((e,t)=>e+t.y,0)/c.length;h>p&&console.warn("[TreeEdges] Inverted relationship detected:",{parents:i.map(e=>({name:e.member.name,y:e.y,gen:e.generation})),children:c.map(e=>({name:e.member.name,y:e.y,gen:e.generation})),avgParentY:h,avgChildY:p});let g=r.some(e=>n.includes(e))&&e.some(e=>n.includes(e));d.push((0,a.jsx)(w,{parentNodes:i,childNodes:c,isHighlighted:g,selectedConnections:l,highlightedConnection:o,onRelationshipAnalyze:m,onConnectionHighlight:u},"connector-group-".concat(s)))}),console.log("[TreeEdges] Generated edges:",{edgeCount:d.length,edgeGroups:h.size}),(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{zIndex:1},children:d})}function N(e){let{opacity:t=.15,scale:n=1}=e,r=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!r.current)return;let e=r.current,t=[],n=(t,n,a)=>{let s=document.createElement("div");s.className="absolute pointer-events-none",s.innerHTML='\n                <svg width="12" height="16" viewBox="0 0 12 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M6 1C3.5 1 1.5 3.5 1.5 7C1.5 10.5 3.5 13.5 6 15C8.5 13.5 10.5 10.5 10.5 7C10.5 3.5 8.5 1 6 1Z" \n                          fill="currentColor" opacity="0.4"/>\n                    <path d="M6 1L6 15" stroke="currentColor" stroke-width="0.5" opacity="0.6"/>\n                </svg>\n            ',s.style.left="".concat(t,"%"),s.style.top="".concat(n,"%"),s.style.color=Math.random()>.5?"rgb(34 197 94)":"rgb(101 163 13)",e.appendChild(s);let r=.5*Math.random()+.3;return p.p8.fromTo(s,{opacity:0,y:-30,rotation:45*Math.random()-22.5,scale:.8},{opacity:.6,y:window.innerHeight+30,rotation:360*Math.random()+180,x:"+=".concat(200*Math.random()-100),scale:1,duration:12+8*Math.random(),delay:a,repeat:-1,ease:"power1.inOut"}),p.p8.to(s,{x:"+=".concat((40*Math.random()-20)*r),duration:(3+2*Math.random())/r,repeat:-1,yoyo:!0,ease:"sine.inOut",delay:a+2*Math.random()}),s};for(let e=0;e<4;e++)t.push(n(100*Math.random(),-30,3*e+2*Math.random()));return()=>{t.forEach(e=>{p.p8.killTweensOf(e),e.parentNode&&e.parentNode.removeChild(e)})}},[]),(0,a.jsx)("div",{ref:r,className:"absolute inset-0 overflow-hidden pointer-events-none",style:{opacity:t,transform:"scale(".concat(n,")"),transformOrigin:"center center"}})}function E(e){let{opacity:t=.08,density:n=1}=e,r=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!r.current)return;let e=r.current;return[{x1:10,y1:20,x2:30,y2:40},{x1:30,y1:40,x2:50,y2:30},{x1:30,y1:40,x2:50,y2:50},{x1:70,y1:60,x2:90,y2:80},{x1:20,y1:70,x2:40,y2:85}].forEach((t,n)=>{let a=document.createElementNS("http://www.w3.org/2000/svg","path"),s="M ".concat(t.x1," ").concat(t.y1," L ").concat(t.x2," ").concat(t.y2);a.setAttribute("d",s),a.setAttribute("stroke","currentColor"),a.setAttribute("stroke-width","1"),a.setAttribute("fill","none"),a.setAttribute("opacity","0"),e.appendChild(a),p.p8.fromTo(a,{opacity:0,strokeDasharray:"100",strokeDashoffset:"100"},{opacity:.3,strokeDashoffset:"0",duration:3,delay:1.5*n,repeat:-1,repeatDelay:12,ease:"power2.out"});let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx","".concat(t.x1)),r.setAttribute("cy","".concat(t.y1)),r.setAttribute("r","3"),r.setAttribute("fill","currentColor"),r.setAttribute("opacity","0"),e.appendChild(r);let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("cx","".concat(t.x2)),i.setAttribute("cy","".concat(t.y2)),i.setAttribute("r","3"),i.setAttribute("fill","currentColor"),i.setAttribute("opacity","0"),e.appendChild(i),p.p8.fromTo([r,i],{opacity:0,scale:0},{opacity:.4,scale:1,duration:1,delay:1.5*n+1,repeat:-1,repeatDelay:13.5,ease:"back.out(1.7)"})}),()=>{for(;e.firstChild;)e.removeChild(e.firstChild)}},[n]),(0,a.jsx)("svg",{ref:r,className:"absolute inset-0 w-full h-full pointer-events-none text-slate-400 dark:text-slate-600",style:{opacity:t},preserveAspectRatio:"none",viewBox:"0 0 100 100"})}var k=n(74291),D=n(70112);function S(){let[e,t]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=()=>t(!0);return document.addEventListener("show-tree-help",e),()=>document.removeEventListener("show-tree-help",e)},[]),(0,s.useEffect)(()=>{let e=()=>t(!1);return document.addEventListener("close-dialogs",e),()=>document.removeEventListener("close-dialogs",e)},[]),(0,a.jsx)(k.Vq,{open:e,onOpenChange:t,children:(0,a.jsxs)(k.cZ,{className:"max-w-2xl max-h-[85vh] flex flex-col z-[9999]",children:[(0,a.jsxs)(k.fK,{className:"flex-shrink-0",children:[(0,a.jsxs)(k.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(D.Z,{className:"h-5 w-5"}),"Family Tree Help & Shortcuts"]}),(0,a.jsx)(k.Be,{children:"Learn how to navigate and interact with your family tree using mouse, touch, and keyboard controls"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-4 py-4 pr-2",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm flex items-center gap-2",children:"\uD83D\uDDB1️ Mouse Controls"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground pl-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Click & Drag:"})," Pan around the tree"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Mouse Wheel:"})," Zoom in and out"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Click Member:"})," View member details"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift+Click Member:"})," Trace lineage to root(s)"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Double-Click Connector:"})," Trace ancestry path"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Triple-Click Connector:"})," Analyze relationship"]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm flex items-center gap-2",children:"\uD83D\uDCF1 Touch Controls"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground pl-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Touch & Drag:"})," Pan around the tree"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Pinch:"})," Zoom in and out"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Tap Member:"})," View member details"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Tap Again (after 1s):"})," Deselect member"]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm flex items-center gap-2",children:"\uD83C\uDF9B️ Canvas Controls"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground pl-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + +:"})," Zoom in"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + _:"})," Zoom out"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + 0:"})," Reset zoom and center view"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + C:"})," Center view"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + F:"})," Toggle fullscreen mode"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + H:"})," Show this help dialog"]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm flex items-center gap-2",children:"\uD83E\uDDED Navigation Shortcuts"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground pl-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + H:"})," Go to Home"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + T:"})," Go to Trees"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + E:"})," Go to Events"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + G:"})," Go to Gallery"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + R:"})," Go to Relationships"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + M:"})," Go to Members"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + I:"})," Go to Invites"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + /:"})," Focus search bar"]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm flex items-center gap-2",children:"\uD83D\uDD0D Traceability Features"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground pl-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift+Click Member Card:"})," Highlights complete ancestry path to root (amber)"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Double-Click Connector:"})," Traces lineage from child to root (10s highlight)"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Triple-Click Connector:"})," Opens relationship analyzer dialog"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Tap-to-Deselect:"})," Click selected member after 1s to close drawer"]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm flex items-center gap-2",children:"\uD83D\uDC65 Family Connections"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground pl-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Green Lines:"})," Show parent-child relationships"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Amber Lines:"})," Highlighted ancestry paths"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Blue Lines:"})," Selected relationships"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Heart Icons:"})," Indicate married couples"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Generations:"})," Arranged top to bottom"]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm flex items-center gap-2",children:"\uD83C\uDFA8 Visual Elements"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground pl-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Background Animation:"})," Phylogenetic branches and DNA helixes"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Member Highlights:"})," Blue ring (selected), Amber ring (traced ancestry)"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Color Coding:"})," Blue (male), Pink (female), Purple (other)"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Deceased Members:"})," Slightly transparent with strikethrough name"]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm flex items-center gap-2",children:"\uD83D\uDCA1 Tips"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground pl-2",children:[(0,a.jsx)("li",{children:"• Use fullscreen mode (Shift+F) for large families"}),(0,a.jsx)("li",{children:"• Shift+Click any member to see their complete ancestry path"}),(0,a.jsx)("li",{children:"• Double-click connectors to trace lineage from that point"}),(0,a.jsx)("li",{children:"• Follow the curved lines to trace relationships"}),(0,a.jsx)("li",{children:"• The tree automatically centers on first load"}),(0,a.jsx)("li",{children:"• Zoom out to see the full family structure"}),(0,a.jsx)("li",{children:"• Search bar supports member names and emails"}),(0,a.jsx)("li",{children:"• Press Shift+? to see all keyboard shortcuts in detail"}),(0,a.jsx)("li",{children:"• Keyboard shortcuts disabled while typing in input fields"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm flex items-center gap-2",children:"\uD83D\uDD27 General"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground pl-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Esc:"})," Close dialogs and exit fullscreen"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + ?:"})," Show complete keyboard shortcuts reference"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + N:"})," Go to Notifications"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Shift + Alt + P:"})," Go to Profile"]})]})]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-4 border-t flex-shrink-0",children:(0,a.jsx)("button",{className:"rounded-md bg-slate-900 px-4 py-2 text-sm text-white hover:bg-slate-800 dark:bg-slate-50 dark:text-slate-900 dark:hover:bg-slate-200 transition-colors",onClick:()=>t(!1),children:"Got it!"})})]})})}var I=n(15863),M=n(73247),P=n(77877),A=n(68919),T=n(92735),_=n(74440),F=n(47416),G=n(70882),L=n(40279),R=n(32060),z=n(50828);let Z={SINGLE_CARD_WIDTH:120,COUPLE_CARD_WIDTH:280,VERTICAL_SPACING:400,FAMILY_GROUP_SPACING:400,SIBLING_SPACING:300};function O(e){if(!e.dob)return null;try{let t;let n=new Date(e.dob);if(e.deceased&&e.dod)t=new Date(e.dod);else{if(e.deceased)return null;t=new Date}let a=t.getTime()-n.getTime();return Math.floor(a/315576e5)}catch(t){return console.warn("[Age Calculation] Invalid date for ".concat(e.name,":"),t),null}}function B(e){return e.length<=1?e:e.every((t,n)=>{if(0===n)return!0;let a=new Set(e[0].parentIds);return t.parentIds.some(e=>a.has(e))})?(console.log("[Age Ordering] Ordering siblings by age: [".concat(e.map(e=>e.name).join(", "),"]")),e.sort((e,t)=>{let n=O(e),a=O(t);return null!==n&&null!==a?a-n:null!==n&&null===a?-1:null===n&&null!==a?1:e.name.localeCompare(t.name)})):(console.log("[Age Ordering] Members are not siblings, skipping age ordering: [".concat(e.map(e=>e.name).join(", "),"]")),e)}function Y(e,t,n){let a=[],s=0;return e.forEach((e,t)=>{let n,r;let i=B(e),l=new Set;i.forEach(e=>{e.childIds.forEach(e=>l.add(e))});let o=l.size,c=Math.max(Z.SIBLING_SPACING,Z.SINGLE_CARD_WIDTH+100),d=o>0?o*Z.SINGLE_CARD_WIDTH+(o-1)*c:0;if(1===i.length)n=Z.SINGLE_CARD_WIDTH;else if(2===i.length)n=i[0].spouseIds.includes(i[1].id)||i[1].spouseIds.includes(i[0].id)?Z.COUPLE_CARD_WIDTH:2*Z.SINGLE_CARD_WIDTH+150;else{let e=[],t=new Set;i.forEach(n=>{if(t.has(n.id))return;let a=i.filter(e=>e.id!==n.id&&n.spouseIds.includes(e.id)&&!t.has(e.id));if(a.length>0){let s=[n,...a];e.push(s),s.forEach(e=>t.add(e.id))}else e.push([n]),t.add(n.id)}),n=1===e.length?Z.COUPLE_CARD_WIDTH:e.length*Z.SINGLE_CARD_WIDTH+(e.length-1)*150}let m=Math.max(d,n,2*Z.SINGLE_CARD_WIDTH);r=1===i.length?"single":2===i.length?i[0].spouseIds.includes(i[1].id)||i[1].spouseIds.includes(i[0].id)?"couple":"coparents":i.reduce((e,t,n)=>e+i.filter((e,t)=>t!==n).filter(e=>t.spouseIds.includes(e.id)).length,0)>0?"couple":"coparents";let u=i.reduce((e,t,n)=>e+i.filter((e,t)=>t!==n).filter(e=>t.spouseIds.includes(e.id)).length,0),h=i.length>2||2===i.length&&0===u;a.push({members:i,type:r,priority:-o,familyUnitId:t,familyUnitIndex:s++,childCount:o,requiredWidth:m,hasStepFamily:h,spouseConnections:u}),console.log("[Clustering] ✅ Final cluster: [".concat(i.map(e=>e.name).join(" + "),"]")),console.log("[Clustering]    - Type: ".concat(r,", Children: ").concat(o,", Required Width: ").concat(m,"px")),h&&console.log("[Clustering]    - \uD83C\uDFE0 Step-family detected with ".concat(u," spousal connections"))}),a}function U(e,t,n){let a=new Map,s=new Map;console.log("[Clustering] Analyzing co-parent relationships for generation ".concat(n,"...")),e.forEach(r=>{if(r.parentIds.length>1){let i=r.parentIds.map(t=>e.find(e=>e.id===t)).filter(e=>void 0!==e),l=r.parentIds.filter(a=>{let s=e.find(e=>e.id===a);return s&&t.get(s.id)===n});if(console.log("[Clustering] \uD83D\uDD0D Child ".concat(r.name," has ").concat(r.parentIds.length," parents:")),i.forEach(e=>{let a=t.get(e.id),s=a===n;console.log("[Clustering]   - ".concat(e.name," (Gen ").concat(a,") ").concat(s?"✅ IN THIS GEN":"❌ DIFFERENT GEN"))}),l.length>1){a.set(r.id,new Set(l));let i=l.map(t=>{var n;return null===(n=e.find(e=>e.id===t))||void 0===n?void 0:n.name});console.log("[Clustering] \uD83D\uDD0D Child ".concat(r.name," has co-parents: [").concat(i.join(", "),"] in generation ").concat(n)),l.forEach(n=>{let a=e.find(e=>e.id===n);a&&console.log("[Clustering]   - ".concat(a.name," is at generation ").concat(t.get(a.id)))});let o=l.map(t=>e.find(e=>e.id===t)).filter(Boolean);for(let e=0;e<o.length;e++)for(let t=e+1;t<o.length;t++){let n=o[e],a=o[t];n.spouseIds.includes(a.id)||a.spouseIds.includes(n.id)||(console.log("[Clustering] \uD83C\uDFE0 Step-family detected: ".concat(n.name," and ").concat(a.name," are co-parents but not spouses")),n.spouseIds.length+n.childIds.length>=a.spouseIds.length+a.childIds.length?(s.has(n.id)||s.set(n.id,[]),s.get(n.id).push(a.id),console.log("[Clustering] \uD83D\uDCCD ".concat(a.name," should be positioned near ").concat(n.name))):(s.has(a.id)||s.set(a.id,[]),s.get(a.id).push(n.id),console.log("[Clustering] \uD83D\uDCCD ".concat(n.name," should be positioned near ").concat(a.name))))}}}});let r=new Map;return a.forEach((e,t)=>{let n=Array.from(e).sort().join("|");r.has(n)||r.set(n,new Set),e.forEach(e=>r.get(n).add(e))}),{coParentGroups:r,stepFamilyRelationships:s}}function K(e,t,n,a){let s=new Set,r=[],i=new Map;return e.forEach(e=>{if(s.has(e.id))return;let t=e.parentIds.sort().join("|");i.has(t)||i.set(t,[]),i.get(t).push(e)}),i.forEach((e,i)=>{B(e).forEach(e=>{if(s.has(e.id))return;let i=e.spouseIds.map(e=>t.find(t=>t.id===e)).filter(e=>void 0!==e&&n.get(e.id)===a&&!s.has(e.id));if(i.length>0){let t=[e,...i],n=2===t.length&&e.spouseIds.includes(t[1].id);r.push({members:t,type:n?"couple":"coparents"}),t.forEach(e=>s.add(e.id)),console.log("[Clustering] \uD83D\uDD17 Nuclear family (sibling + spouse): [".concat(t.map(e=>e.name).join(" + "),"]"))}else r.push({members:[e],type:"single"}),s.add(e.id),console.log("[Clustering] \uD83D\uDC64 Single sibling: ".concat(e.name))})}),e.forEach(e=>{if(s.has(e.id))return;let i=e.spouseIds.map(e=>t.find(t=>t.id===e)).filter(e=>void 0!==e&&n.get(e.id)===a&&!s.has(e.id));if(i.length>0){let t=[e,...i],n=2===t.length&&e.spouseIds.includes(t[1].id);r.push({members:t,type:n?"couple":"coparents"}),t.forEach(e=>s.add(e.id)),console.log("[Clustering] \uD83D\uDD17 Nuclear family (remaining): [".concat(t.map(e=>e.name).join(" + "),"]"))}else r.push({members:[e],type:"single"}),s.add(e.id),console.log("[Clustering] \uD83D\uDC64 Single member (remaining): ".concat(e.name))}),r}var X=n(41858);function H(e){let{members:t,selectedMemberId:r,onMemberClick:l,treeId:o,onCenterOnMember:c,highlightPath:d=[],selectedMember:m,drawerOpen:h=!1,onDrawerOpenChange:g,onEditClick:x,onAddSpouseClick:f,onAddChildClick:v,onAddParentClick:j,onMemberNavigate:y,onRelationshipAnalyze:w}=e,[k,O]=(0,s.useState)([]),[B,H]=(0,s.useState)(null),[V,q]=(0,s.useState)(0),[W,Q]=(0,s.useState)(!1),$=(0,s.useCallback)(e=>{var n;let a=new Set,s=[],r=[],i=e=>{if(a.has(e))return;a.add(e),s.push(e);let n=t.find(t=>t.id===e);if(n){if(0===n.parentIds.length){r.push(e);return}n.parentIds.forEach(e=>{a.has(e)||i(e)})}};return i(e),console.log("[TreeCanvas] \uD83C\uDF33 Lineage trace for ".concat(null===(n=t.find(t=>t.id===e))||void 0===n?void 0:n.name,":"),{totalPath:s.length,rootsFound:r.length,roots:r.map(e=>{var n;return null===(n=t.find(t=>t.id===e))||void 0===n?void 0:n.name})}),s},[t]),J=(0,s.useCallback)(e=>{let[n,a]=e.split("-"),s=$(a),r=t.find(e=>e.id===a),i=t.find(e=>e.id===n);console.log("[TreeCanvas] \uD83D\uDD06 Tracing ancestry from connection ".concat(null==i?void 0:i.name," → ").concat(null==r?void 0:r.name,":"),{connection:e,childId:a,parentId:n,pathToRoot:s,pathLength:s.length,includesParent:s.includes(n),memberNames:s.map(e=>{var n;return null===(n=t.find(t=>t.id===e))||void 0===n?void 0:n.name})}),O(s),setTimeout(()=>{O([])},1e4)},[$,t]),ee=[...d,...k],et=(0,s.useRef)(null),en=(0,s.useRef)(null),[ea,es]=(0,s.useState)({scale:1,translateX:0,translateY:0}),[er,ei]=(0,s.useState)(!1),el=(0,s.useRef)({x:0,y:0}),[eo,ec]=(0,s.useState)({nodes:[],generations:new Map}),[ed,em]=(0,s.useState)(!1),[eu,eh]=(0,s.useState)(""),[ep,eg]=(0,s.useState)([]),[ex,ef]=(0,s.useState)(!1),{user:ev}=(0,z.a)(),{toast:ej}=(0,u.pm)(),eb=(0,s.useCallback)(e=>{let n=$(e.id);console.log("[TreeCanvas] \uD83C\uDF33 Double-click: Tracing lineage for ".concat(e.name,":"),{memberLineage:n,pathLength:n.length,rootCount:n.filter(e=>{let n=t.find(t=>t.id===e);return n&&0===n.parentIds.length}).length}),O(n),setTimeout(()=>{O([])},15e3)},[$,t]),ey=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){console.log("[TreeCanvas] ⇧ Shift+Click: Tracing lineage for ".concat(e.name)),eb(e);return}let n=Date.now(),a=n-V;if(B===e.id&&a<500){eb(e),H(null),q(0);return}if(r===e.id&&a>1e3){console.log("[TreeCanvas] \uD83D\uDC46 Deselecting member: ".concat(e.name)),null==l||l(e),H(null),q(0);return}console.log("[TreeCanvas] \uD83D\uDC46 Selecting member: ".concat(e.name)),H(e.id),q(n),Q(!0),ed&&g?(null==l||l(e),g(!0)):null==l||l(e)},[B,V,r,l,ed,g,eb]),ew=(0,s.useCallback)(()=>{if(!et.current)return;let e=et.current.getBoundingClientRect(),t=e.width/2,n=e.height/2,a=Math.min(ea.scale+.3,3),s=(t-ea.translateX)/ea.scale,r=(n-ea.translateY)/ea.scale;p.p8.to(ea,{scale:a,translateX:t-s*a,translateY:n-r*a,duration:.4,ease:"power2.out",onUpdate:()=>{es({...ea})}})},[ea]),eC=(0,s.useCallback)(()=>{if(!et.current)return;let e=et.current.getBoundingClientRect(),t=e.width/2,n=e.height/2,a=Math.max(ea.scale-.3,.1),s=(t-ea.translateX)/ea.scale,r=(n-ea.translateY)/ea.scale;p.p8.to(ea,{scale:a,translateX:t-s*a,translateY:n-r*a,duration:.4,ease:"power2.out",onUpdate:()=>{es({...ea})}})},[ea]),eN=(0,s.useCallback)(()=>{if(et.current&&eo.nodes.length>0){let e=et.current.getBoundingClientRect(),t=e.width/2,n=e.height/2,a=Math.min(...eo.nodes.map(e=>e.x))-200,s=Math.max(...eo.nodes.map(e=>e.x))+200,r=Math.min(...eo.nodes.map(e=>e.y))-200,i=Math.max(...eo.nodes.map(e=>e.y))+200,l=.8*Math.min(Math.min(e.width/(s-a),e.height/(i-r)),1);p.p8.to(ea,{scale:l,translateX:t-(a+s)/2*l,translateY:n-(r+i)/2*l,duration:1,ease:"power2.inOut",onUpdate:()=>{es({...ea})}})}else p.p8.to(ea,{scale:1,translateX:0,translateY:0,duration:.8,ease:"power2.inOut",onUpdate:()=>{es({...ea})}})},[ea,eo.nodes]),eE=(0,s.useCallback)(e=>{if(eh(e),!e.trim()){eg([]),ef(!1);return}let n=t.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.email&&t.email.toLowerCase().includes(e.toLowerCase())).sort((e,t)=>e.name.localeCompare(t.name)).slice(0,8);eg(n),ef(n.length>0)},[t]),ek=(0,s.useCallback)(e=>{let t=eo.nodes.find(t=>t.member.id===e.id);if(!t||!et.current)return;let n=et.current.getBoundingClientRect(),a=n.width/2,s=n.height/2,r={scale:Math.max(ea.scale,.8),translateX:a-t.x*Math.max(ea.scale,.8),translateY:s-t.y*Math.max(ea.scale,.8)};p.p8.to(ea,{...r,duration:1.2,ease:"power2.inOut",onUpdate:()=>{es({...ea})}}),eh(""),ef(!1),O([e.id]),setTimeout(()=>O([]),3e3),l&&l(e),c&&c(e.id)},[eo.nodes,ea,l,c]),eD=(0,s.useCallback)(()=>{if(!ev)return;let e=t.find(e=>e.email===ev.email||e.id===ev.id);e?(ek(e),ej({title:"Found you! \uD83D\uDC4B",description:"Navigated to ".concat(e.name)})):ej({title:"Not found",description:"You are not a member of this tree yet.",variant:"destructive"})},[ev,t,ek,ej]),eS=(0,s.useCallback)(async e=>{if(!en.current)return;let t={...ea};try{if("undefined"==typeof document)throw Error("Export is only available in browser environment");if(0===eo.nodes.length){ej({title:"Nothing to export",description:"The family tree is empty",variant:"destructive"});return}ej({title:"Preparing export...",description:"Generating your family tree image"}),es({scale:1,translateX:0,translateY:0}),await new Promise(e=>setTimeout(e,300));let a=Math.min(...eo.nodes.map(e=>e.x))-150,s=Math.max(...eo.nodes.map(e=>e.x))+150,r=Math.min(...eo.nodes.map(e=>e.y))-150,i=Math.max(...eo.nodes.map(e=>e.y))+150,l=s-a,o=i-r,c=document.createElement("div");c.style.position="fixed",c.style.left="0",c.style.top="0",c.style.width="".concat(l,"px"),c.style.height="".concat(o,"px"),c.style.overflow="hidden",c.style.zIndex="-9999",c.style.pointerEvents="none";let d=en.current.cloneNode(!0);d.style.transform="translate(".concat(-a,"px, ").concat(-r,"px)"),d.style.transformOrigin="0 0",c.appendChild(d),document.body.appendChild(c),await new Promise(e=>setTimeout(e,100));let m=(await n.e(7337).then(n.t.bind(n,24457,23))).default,u=await m(c,{width:l,height:o,backgroundColor:"#ffffff",scale:2,useCORS:!0,allowTaint:!0,logging:!1,imageTimeout:15e3});if(document.body.removeChild(c),es(t),"png"===e){let e=document.createElement("a"),t=new Date().toISOString().split("T")[0];e.download="family-tree-".concat(t,".png"),e.href=u.toDataURL("image/png",1),document.body.appendChild(e),e.click(),document.body.removeChild(e),ej({title:"PNG exported! \uD83D\uDCF8",description:"Your family tree has been downloaded as a PNG image"})}else{let e=(await Promise.all([n.e(3125),n.e(2505),n.e(8758)]).then(n.bind(n,53375))).default,t=l>o?"landscape":"portrait",a=new e({orientation:t,unit:"px",format:[l,o],compress:!0});a.addImage(u.toDataURL("image/png",1),"PNG",0,0,l,o,void 0,"FAST");let s=new Date().toISOString().split("T")[0];a.save("family-tree-".concat(s,".pdf")),ej({title:"PDF exported! \uD83D\uDCC4",description:"Your family tree has been downloaded as a PDF document"})}}catch(e){console.error("Export failed:",e),es(t),ej({title:"Export failed",description:e instanceof Error?e.message:"Could not export the family tree. Please try again.",variant:"destructive"})}},[eo.nodes,ej]),eI=(0,s.useCallback)(async()=>{if(!navigator.share){try{await navigator.clipboard.writeText(window.location.href),ej({title:"Link copied! \uD83D\uDCCB",description:"Family tree link copied to clipboard"})}catch(e){ej({title:"Could not copy link",description:"Please copy the URL manually from your browser",variant:"destructive"})}return}try{await navigator.share({title:"Family Tree",text:"Check out our family tree!",url:window.location.href})}catch(e){console.log("Share cancelled or failed:",e)}},[ej]),eM=(0,s.useCallback)(()=>{eN()},[eN]),eP=(0,s.useCallback)(()=>{em(!ed)},[ed]),eA=(0,s.useCallback)(()=>{let e=new CustomEvent("show-tree-help");document.dispatchEvent(e)},[]);(0,X.BV)({zoomIn:ew,zoomOut:eC,resetZoom:eN,centerView:eM,toggleFullscreen:eP,showHelp:eA}),(0,s.useEffect)(()=>{if(t.length>0){console.log("[TreeCanvas] Calculating layout for members:",t.map(e=>({id:e.id,name:e.name,parentIds:e.parentIds,childIds:e.childIds,spouseIds:e.spouseIds})));let e=function(e){console.log("[Layout] Starting nuclear family-aware tree layout calculation...");let{generationMap:t,generations:n}=function(e){let t=new Map,n=new Map;console.log("[Generation] Starting robust generation calculation...");let a=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(n.has(t))return 0;n.add(t);let s=e.find(e=>e.id===t);return s&&0!==s.childIds.length?1+Math.max(...s.childIds.map(e=>a(e,new Set(n))),0):0},s=e.filter(e=>0===e.parentIds.length),r=s.map(e=>({member:e,depth:a(e.id)})).filter(e=>{let{depth:t}=e;return t>0}).sort((e,t)=>t.depth-e.depth).map(e=>{let{member:t}=e;return t}),i=r.length>0?r:s;console.log("[Generation] Selected roots:",i.map(e=>e.name)),i.forEach(e=>{t.set(e.id,0),console.log("[Generation] Set root ".concat(e.name," = Gen 0"))});let l=!0,o=0;for(;l&&o<20;)l=!1,o++,e.forEach(n=>{if(t.has(n.id))return;let a=n.parentIds.filter(t=>e.some(e=>e.id===t));if(0===a.length){t.set(n.id,0),l=!0,console.log("[Generation] Set ".concat(n.name," = Gen 0 (no valid parents)"));return}let s=a.map(e=>t.get(e)).filter(e=>void 0!==e);if(s.length===a.length&&s.length>0){let e=Math.max(...s)+1;t.set(n.id,e),l=!0,console.log("[Generation] Set ".concat(n.name," = Gen ").concat(e))}});console.log("[Generation] Aligning co-parents and their siblings...");let c=!0,d=0;for(;c&&d<10;)c=!1,d++,e.forEach(n=>{if(n.parentIds.length<=1)return;let a=n.parentIds.map(n=>({id:n,member:e.find(e=>e.id===n),generation:t.get(n)})).filter(e=>e.member&&void 0!==e.generation);if(a.length<=1)return;let s=t.get(n.id);if(void 0===s)return;let r=s-1;a.filter(e=>e.generation!==r).length>0&&a.forEach(n=>{if(n.generation!==r){var a;console.log("[Generation] Aligning co-parent ".concat(null===(a=n.member)||void 0===a?void 0:a.name," to Gen ").concat(r)),t.set(n.id,r),c=!0,n.member&&n.member.parentIds.forEach(a=>{let s=e.find(e=>e.id===a);s&&s.childIds.forEach(a=>{if(a===n.id)return;let i=e.find(e=>e.id===a);if(!i)return;let l=t.get(a);l!==r&&(console.log("[Generation] \uD83C\uDF33 GENERATIONAL BASELINE: Moving ".concat(i.name," from Gen ").concat(l," to Gen ").concat(r," (same generation as co-parent ").concat(n.member.name," - all children of ").concat(s.name,")")),t.set(a,r),c=!0)})})}})});console.log("[Generation] Enforcing sibling cohesion across family branches...");let m=!0,u=0;for(;m&&u<10;)m=!1,u++,e.forEach(n=>{let a=t.get(n.id);void 0!==a&&e.filter(e=>e.id!==n.id&&e.parentIds.filter(e=>n.parentIds.includes(e)).length>0).forEach(e=>{let s=t.get(e.id);void 0!==s&&s!==a&&(console.log("[Generation] \uD83D\uDD17 Sibling cohesion: Moving ".concat(e.name," from Gen ").concat(s," to Gen ").concat(a," (same as sibling ").concat(n.name,")")),t.set(e.id,a),m=!0)})});console.log("[Generation] Aligning spouses and their entire family trees...");let h=!0,p=0,g=function(n,a){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"family adjustment",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(s.has(n)||i>8)return;s.add(n);let l=e.find(e=>e.id===n);if(!l)return;let o=t.get(n);o!==a&&(console.log("[Generation] \uD83D\uDD27 ".concat(r,": ").concat(l.name," from Gen ").concat(o," to Gen ").concat(a)),t.set(n,a),h=!0);let c=new Set(s);l.parentIds.forEach(e=>{c.has(e)||g(e,a-1,c,"parent of ".concat(l.name),i+1)}),l.childIds.forEach(e=>{c.has(e)||g(e,a+1,c,"child of ".concat(l.name),i+1)}),l.parentIds.forEach(s=>{let r=e.find(e=>e.id===s);!r||c.has(s)||r.childIds.forEach(s=>{if(s===n||c.has(s))return;let o=e.find(e=>e.id===s);if(!o)return;let d=t.get(s);d!==a&&(console.log("[Generation] \uD83C\uDF33 GENERATIONAL BASELINE: Adjusting ".concat(o.name," from Gen ").concat(d," to Gen ").concat(a," (same generation as ").concat(l.name," - all children of ").concat(r.name,")")),g(s,a,c,"generational baseline with ".concat(l.name),i+1))})}),l.spouseIds.forEach(e=>{c.has(e)||g(e,a,c,"spouse of ".concat(l.name),i+1)}),l.spouseIds.forEach(t=>{let n=e.find(e=>e.id===t);!n||c.has(t)||(n.parentIds.forEach(n=>{if(!c.has(n)){g(n,a-1,c,"in-law parent of ".concat(l.name),i+1);let s=e.find(e=>e.id===n);s&&s.childIds.forEach(e=>{e===t||c.has(e)||g(e,a,c,"in-law sibling of ".concat(l.name),i+1)})}}),n.parentIds.forEach(t=>{let n=e.find(e=>e.id===t);n&&n.parentIds.forEach(e=>{c.has(e)||g(e,a-2,c,"in-law grandparent of ".concat(l.name),i+1)})}),n.childIds.forEach(e=>{l.childIds.includes(e)||c.has(e)||g(e,a+1,c,"step-child of ".concat(l.name),i+1)}),e.forEach(e=>{!(e.id===t||c.has(e.id))&&e.parentIds.filter(e=>n.parentIds.includes(e)).length>0&&(g(e.id,a,c,"in-law sibling of ".concat(l.name),i+1),e.childIds.forEach(e=>{c.has(e)||g(e,a+1,c,"in-law niece/nephew of ".concat(l.name),i+1)}))}))})};for(;h&&p<15;)h=!1,p++,e.forEach(n=>{let a=t.get(n.id);void 0!==a&&n.spouseIds.forEach(n=>{let s=e.find(e=>e.id===n);if(!s)return;let r=t.get(n);r!==a&&(console.log("[Generation] \uD83C\uDF33 Adjusting entire married-in family tree for spouse: ".concat(s.name," (").concat(r," → ").concat(a,")")),g(n,a,new Set,"married-in family alignment"),s.parentIds.forEach(r=>{let i=e.find(e=>e.id===r);i&&i.childIds.forEach(r=>{if(r===n)return;let l=e.find(e=>e.id===r);if(!l)return;let o=t.get(r);o!==a&&(console.log("[Generation] \uD83C\uDF33 SPOUSE GENERATIONAL BASELINE: Moving ".concat(l.name," from Gen ").concat(o," to Gen ").concat(a," (same generation as married-in ").concat(s.name," - all children of ").concat(i.name,")")),g(r,a,new Set,"generational baseline with married-in ".concat(s.name)))})}))})});console.log("[Generation] Final validation of married-in family positioning...");let x=!0,f=0;for(;x&&f<5;)x=!1,f++,e.forEach(n=>{let a=t.get(n.id);void 0!==a&&(n.parentIds.forEach(n=>{let s=t.get(n);if(void 0!==s&&s>=a){var r;let s=a-1;console.log("[Generation] \uD83D\uDD27 Final validation: Moving parent to maintain hierarchy: ".concat(null===(r=e.find(e=>e.id===n))||void 0===r?void 0:r.name," to Gen ").concat(s)),t.set(n,s),x=!0}}),n.childIds.forEach(n=>{let s=t.get(n);if(void 0!==s&&s<=a){var r;let s=a+1;console.log("[Generation] \uD83D\uDD27 Final validation: Moving child to maintain hierarchy: ".concat(null===(r=e.find(e=>e.id===n))||void 0===r?void 0:r.name," to Gen ").concat(s)),t.set(n,s),x=!0}}))});console.log("[Generation] Final sibling cohesion enforcement...");let v=!0,j=0;for(;v&&j<5;)v=!1,j++,e.forEach(n=>{let a=t.get(n.id);void 0!==a&&e.forEach(e=>{if(e.id!==n.id&&e.parentIds.filter(e=>n.parentIds.includes(e)).length>0){let s=t.get(e.id);void 0!==s&&s!==a&&(console.log("[Generation] \uD83D\uDD17 Final sibling alignment: ".concat(e.name," from Gen ").concat(s," to Gen ").concat(a," (same as ").concat(n.name,")")),t.set(e.id,a),v=!0)}})});return e.forEach(e=>{t.has(e.id)||(t.set(e.id,0),console.log("[Generation] Set orphan ".concat(e.name," = Gen 0")))}),e.forEach(e=>{let a=t.get(e.id);n.has(a)||n.set(a,[]),n.get(a).push(e)}),console.log("[Generation] \uD83C\uDFAF FINAL Generation structure with sibling cohesion:"),Array.from(n.entries()).sort((e,t)=>{let[n]=e,[a]=t;return n-a}).forEach(e=>{let[t,n]=e;console.log("  Gen ".concat(t,": ").concat(n.map(e=>e.name).join(", ")));let a=new Map;n.forEach(e=>{if(e.parentIds.length>0){let t=e.parentIds.sort().join("|");a.has(t)||a.set(t,[]),a.get(t).push(e.name)}}),a.forEach((e,t)=>{e.length>1&&console.log("    \uD83D\uDD17 Sibling group: [".concat(e.join(", "),"] (parents: ").concat(t,")"))})}),{generationMap:t,generations:n}}(e),a=function(e,t,n){console.log("[Clustering] Starting nuclear family-aware clustering...");let a=new Map;return Array.from(n.keys()).forEach(e=>{a.set(e,[])}),Array.from(n.entries()).sort((e,t)=>{let[n]=e,[a]=t;return n-a}).forEach(n=>{let[s,r]=n;if(console.log("[Clustering] Processing generation ".concat(s," with ").concat(r.length," members")),0===s){let n=function(e,t,n,a){console.log("[Clustering] Processing ROOT generation ".concat(e," with step-family awareness"));let s=new Set,r=new Map,{coParentGroups:i,stepFamilyRelationships:l}=U(n,a,e);return console.log("[Clustering] Found ".concat(i.size," co-parent groups:")),i.forEach((e,t)=>{let a=Array.from(e).map(e=>{var t;return null===(t=n.find(t=>t.id===e))||void 0===t?void 0:t.name});console.log("[Clustering] \uD83D\uDC65 Co-parent group: [".concat(a.join(" + "),"] (key: ").concat(t,")"))}),console.log("[Clustering] Step-family relationships:"),l.forEach((e,t)=>{var a;let s=null===(a=n.find(e=>e.id===t))||void 0===a?void 0:a.name,r=e.map(e=>{var t;return null===(t=n.find(t=>t.id===e))||void 0===t?void 0:t.name});console.log("[Clustering] \uD83D\uDD17 ".concat(s," -> [").concat(r.join(", "),"]"))}),t.forEach(t=>{if(s.has(t.id))return;let i=t.spouseIds.map(e=>n.find(t=>t.id===e)).filter(t=>void 0!==t&&a.get(t.id)===e&&!s.has(t.id));if(i.length>0){let e=[t,...i],n=e.map(e=>e.id).sort().join("-");r.set(n,e),e.forEach(e=>s.add(e.id)),console.log("[Clustering] ✅ Created spousal group: [".concat(e.map(e=>e.name).join(" + "),"]"))}}),console.log("[Clustering] STEP 3: Processing ".concat(i.size," co-parent groups...")),i.forEach((e,t)=>{let a=Array.from(e).map(e=>n.find(t=>t.id===e)).filter(e=>void 0!==e);if(console.log("[Clustering] Processing co-parent group: [".concat(a.map(e=>e.name).join(" + "),"]")),a.length>1){let e=a.filter(e=>s.has(e.id)),t=a.filter(e=>!s.has(e.id));if(console.log("[Clustering] - Already processed: [".concat(e.map(e=>e.name).join(", "),"]")),console.log("[Clustering] - Not processed: [".concat(t.map(e=>e.name).join(", "),"]")),e.length>0&&t.length>0){let n=e[0],a=null,i=null;for(let[e,t]of r.entries())if(t.some(e=>e.id===n.id)){a=e,i=t;break}if(a&&i){t.forEach(e=>{i.push(e),s.add(e.id),console.log("[Clustering] \uD83D\uDD17 Added co-parent ".concat(e.name," to existing family group with ").concat(n.name))}),r.delete(a);let e=i.map(e=>e.id).sort().join("-");r.set(e,i),console.log("[Clustering] ✅ Updated family group: [".concat(i.map(e=>e.name).join(" + "),"]"))}}else if(t.length>1){let e=t.map(e=>e.id).sort().join("-");r.set(e,t),t.forEach(e=>s.add(e.id)),console.log("[Clustering] \uD83D\uDD17 Created co-parent group: [".concat(t.map(e=>e.name).join(" + "),"]"))}else console.log("[Clustering] ⚠️ Skipping co-parent group - insufficient unprocessed members")}else console.log("[Clustering] ⚠️ Skipping single-member co-parent group")}),t.forEach(e=>{if(s.has(e.id))return;let t=e.id;r.set(t,[e]),s.add(e.id),console.log("[Clustering] ✅ Created single member: ".concat(e.name))}),Y(r,e,n)}(s,r,e,t);a.set(s,n)}else{let n=s-1,i=function(e,t,n,a,s){console.log("[Clustering] Processing DESCENDANT generation ".concat(e," with nuclear family ordering"));let r=new Set,i=[],{coParentGroups:l}=U(n,a,e);console.log("[Clustering] Found ".concat(l.size," co-parent groups in generation ").concat(e,":")),l.forEach((e,t)=>{let a=Array.from(e).map(e=>{var t;return null===(t=n.find(t=>t.id===e))||void 0===t?void 0:t.name});console.log("[Clustering] \uD83D\uDC65 Co-parent group: [".concat(a.join(" + "),"] (key: ").concat(t,")"))}),console.log("[Clustering] STEP 1: Processing co-parent groups for generation ".concat(e," (PRIORITY)...")),l.forEach((t,l)=>{let o=Array.from(t).map(e=>n.find(t=>t.id===e)).filter(e=>void 0!==e).filter(t=>a.get(t.id)===e);if(console.log("[Clustering] Processing co-parent group: [".concat(o.map(e=>e.name).join(" + "),"]")),o.length>1&&!o.some(e=>r.has(e.id))){let e=o.map(e=>e.id).sort().join("-"),t=999;for(let e=0;e<s.length;e++)if(s[e].members.some(e=>e.childIds.some(e=>o.some(t=>t.id===e)))){t=e;break}let n=2===o.length&&o[0].spouseIds.includes(o[1].id);i.push({familyKey:e,members:o,parentOrder:t}),o.forEach(e=>r.add(e.id)),console.log("[Clustering] \uD83D\uDD17 Created co-parent group: [".concat(o.map(e=>e.name).join(" + "),"] (").concat(n?"couple":"co-parents",", parent order: ").concat(t,")"))}}),s.forEach((t,s)=>{console.log("[Clustering] Processing children of parent cluster ".concat(s,": [").concat(t.members.map(e=>e.name).join(" + "),"]"));let l=new Set;t.members.forEach(t=>{t.childIds.forEach(t=>{let s=n.find(e=>e.id===t);s&&a.get(s.id)===e&&!r.has(s.id)&&l.add(s)})}),l.size>0&&(console.log("[Clustering] Found ".concat(l.size," children: [").concat(Array.from(l).map(e=>e.name).join(", "),"]")),K(Array.from(l),n,a,e).forEach(e=>{let t=e.members.map(e=>e.id).sort().join("-");i.push({familyKey:t,members:e.members,parentOrder:s}),e.members.forEach(e=>r.add(e.id))}))});let o=t.filter(e=>!r.has(e.id));o.length>0&&(console.log("[Clustering] STEP 3: Processing ".concat(o.length," remaining members without clear parent ordering")),K(o,n,a,e).forEach(e=>{let t=e.members.map(e=>e.id).sort().join("-");i.push({familyKey:t,members:e.members,parentOrder:999})})),i.sort((e,t)=>e.parentOrder-t.parentOrder),console.log("[Clustering] Final ordered family groups for generation ".concat(e,":")),i.forEach((e,t)=>{console.log("[Clustering]   ".concat(t,": [").concat(e.members.map(e=>e.name).join(" + "),"] (parent order: ").concat(e.parentOrder,")"))});let c=new Map;return i.forEach(e=>{c.set(e.familyKey,e.members)}),Y(c,e,n)}(s,r,e,t,a.get(n)||[]);a.set(s,i)}}),a}(e,t,n);console.log("[Layout] Family clusters created:"),Array.from(a.entries()).forEach(e=>{let[t,n]=e;console.log("[Layout] Gen ".concat(t,": ").concat(n.length," clusters")),n.forEach((e,t)=>{console.log("[Layout] ".concat(t,": [").concat(e.members.map(e=>e.name).join(" + "),"] (").concat(e.type,")"))})});let s=function(e,t,n){console.log("[Positioning] Starting space-aware positioning...");let a=[],s=Array.from(e.keys()).sort((e,t)=>e-t),r=new Map;return s.forEach(s=>{let i=e.get(s),l=s*Z.VERTICAL_SPACING,o=0;console.log("[Positioning] PASS 1 - Positioning generation ".concat(s," with space awareness")),i.forEach((e,i)=>{let c=e.requiredWidth||Z.SINGLE_CARD_WIDTH,d=o+c/2;if(console.log("[Positioning] Family [".concat(e.members.map(e=>e.name).join(" + "),"]: center=").concat(d,", width=").concat(c)),"couple"===e.type){let t={member:e.members[0],x:d,y:l,generation:s,spouses:e.members.slice(1),familyUnitId:e.familyUnitId};a.push(t)}else if("coparents"===e.type){let r=[],i=new Set;e.members.forEach(t=>{if(i.has(t.id))return;let n=e.members.filter(e=>e.id!==t.id&&t.spouseIds.includes(e.id)&&!i.has(e.id));if(n.length>0){let e=[t,...n];r.push(e),e.forEach(e=>i.add(e.id)),console.log("[Positioning] \uD83D\uDC91 Created spouse group: [".concat(e.map(e=>e.name).join(" + "),"]"))}else r.push([t]),i.add(t.id),console.log("[Positioning] \uD83D\uDC64 Single co-parent: ".concat(t.name))});let o=r.length,c=d-((o-1)*150+o*Z.SINGLE_CARD_WIDTH)/2;r.forEach((r,i)=>{if(1===r.length){let i=r[0],o=i.spouseIds.map(e=>t.find(t=>t.id===e)).filter(e=>void 0!==e&&n.get(e.id)===s),d={member:i,x:c,y:l,generation:s,spouses:o.filter(t=>e.members.some(e=>e.id===t.id)),familyUnitId:e.familyUnitId};a.push(d),console.log("[Positioning] Single co-parent ".concat(i.name," positioned at x=").concat(d.x))}else{let t=r[0],n=r.slice(1),i={member:t,x:c,y:l,generation:s,spouses:n,familyUnitId:e.familyUnitId};a.push(i),console.log("[Positioning] Spouse group [".concat(r.map(e=>e.name).join(" + "),"] positioned at x=").concat(i.x))}i<o-1&&(c+=150)})}else e.members.forEach((r,i)=>{let o=r.spouseIds.map(e=>t.find(t=>t.id===e)).filter(e=>void 0!==e&&n.get(e.id)===s),c={member:r,x:d,y:l,generation:s,spouses:o,familyUnitId:e.familyUnitId};a.push(c)});let m=e.familyUnitId||e.members[0].id;r.set(m,d),o+=c+Z.FAMILY_GROUP_SPACING});let c=-(o-Z.FAMILY_GROUP_SPACING)/2;a.filter(e=>e.generation===s).forEach(e=>{e.x+=c;let t=e.member,n=e.familyUnitId||t.id,a=r.get(n);void 0!==a&&r.set(n,a+c)}),console.log("[Positioning] Generation ".concat(s," centered with offset ").concat(c))}),console.log("[Positioning] ✅ Space-aware positioning complete!"),a}(a,e,t);return console.log("[Layout] ✅ Nuclear family-aware layout complete!"),console.log("[Layout] Generated ".concat(s.length," nodes across ").concat(n.size," generations")),{nodes:s,generations:n}}(t);if(console.log("[TreeCanvas] Layout calculated:",{nodeCount:e.nodes.length,generations:Array.from(e.generations.entries()).map(e=>{let[t,n]=e;return{generation:t,memberCount:n.length,members:n.map(e=>e.name)}}),nodes:e.nodes.map(e=>({name:e.member.name,x:e.x,y:e.y,generation:e.generation,spouseCount:e.spouses.length}))}),ec(e),et.current&&e.nodes.length>0){let t=et.current.getBoundingClientRect(),n=t.width/2,a=t.height/2,s=Math.min(...e.nodes.map(e=>e.x))-200,r=Math.max(...e.nodes.map(e=>e.x))+200,i=Math.min(...e.nodes.map(e=>e.y))-200,l=Math.max(...e.nodes.map(e=>e.y))+200,o=.8*Math.min(Math.min(t.width/(r-s),t.height/(l-i)),1);es({scale:o,translateX:n-(s+r)/2*o,translateY:a-(i+l)/2*o})}}},[t]);let eT=(0,s.useCallback)(e=>{if(e.preventDefault(),!et.current)return;let t=-.001*e.deltaY,n=Math.min(Math.max(.1,ea.scale+t),3),a=et.current.getBoundingClientRect(),s=e.clientX-a.left,r=e.clientY-a.top,i=(s-ea.translateX)/ea.scale,l=(r-ea.translateY)/ea.scale;es({scale:n,translateX:s-i*n,translateY:r-l*n})},[ea]),e_=(0,s.useCallback)(e=>{0===e.button&&(ei(!0),el.current={x:e.clientX-ea.translateX,y:e.clientY-ea.translateY})},[ea.translateX,ea.translateY]),eF=(0,s.useCallback)(e=>{er&&es(t=>({...t,translateX:e.clientX-el.current.x,translateY:e.clientY-el.current.y}))},[er]),eG=(0,s.useCallback)(()=>{ei(!1)},[]),eL=(0,s.useCallback)(e=>{if(1===e.touches.length){ei(!0);let t=e.touches[0];el.current={x:t.clientX-ea.translateX,y:t.clientY-ea.translateY}}},[ea.translateX,ea.translateY]),eR=(0,s.useCallback)(e=>{if(e.preventDefault(),1===e.touches.length&&er){let t=e.touches[0];es(e=>({...e,translateX:t.clientX-el.current.x,translateY:t.clientY-el.current.y}))}else if(2===e.touches.length){let t=e.touches[0],n=e.touches[1],a=Math.sqrt(Math.pow(n.clientX-t.clientX,2)+Math.pow(n.clientY-t.clientY,2));if(el.current.pinchDistance){let e=a/el.current.pinchDistance,s=Math.min(Math.max(.1,el.current.initialScale*e),3);if(et.current){let e=et.current.getBoundingClientRect(),a=(t.clientX+n.clientX)/2-e.left,r=(t.clientY+n.clientY)/2-e.top,i=(a-ea.translateX)/ea.scale,l=(r-ea.translateY)/ea.scale;es({scale:s,translateX:a-i*s,translateY:r-l*s})}else es(e=>({...e,scale:s}))}else el.current.pinchDistance=a,el.current.initialScale=ea.scale}},[er,ea.scale]),ez=(0,s.useCallback)(()=>{ei(!1),el.current.pinchDistance&&(el.current.pinchDistance=void 0,el.current.initialScale=void 0)},[]);(0,s.useEffect)(()=>{if(W&&c&&r){let n=eo.nodes.find(e=>e.member.id===r);if(n||(n=eo.nodes.find(e=>e.spouses.some(e=>e.id===r))),n&&et.current){var e,t;let a=et.current.getBoundingClientRect(),s=a.width/2,i=a.height/2,l={scale:1.2,translateX:s-1.2*n.x,translateY:i-1.2*n.y},o=p.p8.timeline(),c=(null===(e=en.current)||void 0===e?void 0:e.querySelector('[data-member-id="'.concat(r,'"]')))||(null===(t=en.current)||void 0===t?void 0:t.querySelector('[data-member-id="'.concat(n.member.id,'"]')));c&&o.to(c,{scale:1.1,duration:.2,ease:"power2.out",yoyo:!0,repeat:1},0),o.to(ea,{...l,duration:1.2,ease:"power3.inOut",onUpdate:()=>{es({...ea})}},.2)}Q(!1)}},[W,r,eo.nodes,c]),(0,s.useEffect)(()=>{en.current&&p.p8.set(en.current,{x:ea.translateX,y:ea.translateY,scale:ea.scale})},[ea]),(0,s.useEffect)(()=>{if(!en.current||0===eo.nodes.length)return;let e=en.current.querySelectorAll(".tree-member-node"),t=new Map;e.forEach(e=>{let n=parseInt(e.getAttribute("data-generation")||"0");t.has(n)||t.set(n,[]),t.get(n).push(e)});let n=p.p8.timeline({delay:1.5});return Array.from(t.entries()).sort((e,t)=>{let[n]=e,[a]=t;return n-a}).forEach((e,t)=>{let[,a]=e;n.set(a,{opacity:0,scale:.3,y:"+=30",rotationY:90},0),n.to(a,{opacity:1,scale:1,y:"-=30",rotationY:0,duration:1.2,ease:"back.out(1.4)",stagger:{amount:1,from:"center"}},.5*t)}),()=>{n.kill()}},[eo.nodes]),(0,s.useEffect)(()=>{let e=et.current;if(e)return e.addEventListener("wheel",eT,{passive:!1}),()=>e.removeEventListener("wheel",eT)},[eT]);let eZ=(0,s.useCallback)(()=>{if(document.fullscreenElement){if(h&&g){g(!1);return}document.exitFullscreen(),em(!1)}else{var e;null===(e=et.current)||void 0===e||e.requestFullscreen(),em(!0)}},[h,g]);return((0,s.useEffect)(()=>{let e=()=>{em(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),0===t.length)?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 text-muted-foreground",children:[(0,a.jsx)(I.Z,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("p",{children:"Loading family tree..."})]})}):(0,a.jsxs)("div",{ref:et,className:"relative h-full w-full overflow-hidden bg-slate-50 dark:bg-slate-900",onMouseDown:e_,onMouseMove:eF,onMouseUp:eG,onMouseLeave:eG,onTouchStart:eL,onTouchMove:eR,onTouchEnd:ez,style:{cursor:er?"grabbing":"grab",touchAction:"none"},children:[(0,a.jsxs)("div",{className:"absolute inset-0",style:{zIndex:1},children:[(0,a.jsx)(E,{opacity:.06,density:.8}),(0,a.jsx)(N,{opacity:.08,scale:1})]}),(0,a.jsxs)("div",{ref:en,className:"absolute",style:{transformOrigin:"0 0",zIndex:10},children:[(0,a.jsx)(C,{nodes:eo.nodes,highlightPath:ee,onRelationshipAnalyze:w,onConnectionHighlight:J}),eo.nodes.map((e,t)=>(0,a.jsx)("div",{className:"absolute tree-member-node",style:{left:e.x,top:e.y,transform:"translate(-50%, -50%)"},"data-generation":e.generation,"data-index":t,"data-member-id":e.member.id,children:(0,a.jsx)(b,{member:e.member,spouses:e.spouses,isSelected:r===e.member.id,isHighlighted:ee.includes(e.member.id),onClick:t=>ey(e.member,(null==t?void 0:t.shiftKey)||!1),onMemberClick:l,selectedMemberId:r})},e.member.id))]}),(0,a.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 transition-opacity duration-200 ".concat(h?"opacity-0 pointer-events-none":"opacity-100"),style:{zIndex:h?10:1e3,pointerEvents:h?"none":"auto"},onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-white/90 dark:bg-gray-800/90 backdrop-blur-md rounded-full px-4 py-2 shadow-lg border border-white/20 dark:border-gray-700/20",children:[(0,a.jsx)(M.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)(L.I,{type:"text",placeholder:"Search family members...",value:eu,onChange:e=>eE(e.target.value),className:"border-0 bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0 placeholder:text-muted-foreground/70 text-foreground min-w-[250px]"}),ev&&(0,a.jsx)(i.z,{variant:"ghost",size:"sm",onClick:eD,className:"rounded-full h-8 w-8 p-0 hover:bg-blue-100 dark:hover:bg-blue-900/20",title:"Navigate to me",children:(0,a.jsx)(P.Z,{className:"h-4 w-4 text-blue-600"})}),(0,a.jsxs)(R.h_,{children:[(0,a.jsx)(R.$F,{asChild:!0,children:(0,a.jsx)(i.z,{variant:"ghost",size:"sm",className:"rounded-full h-8 w-8 p-0 hover:bg-green-100 dark:hover:bg-green-900/20",title:"Export & Share",children:(0,a.jsx)(A.Z,{className:"h-4 w-4 text-green-600"})})}),(0,a.jsxs)(R.AW,{align:"end",className:"w-48",children:[(0,a.jsxs)(R.Xi,{onClick:()=>eS("png"),children:[(0,a.jsx)(T.Z,{className:"mr-2 h-4 w-4"}),"Export as PNG"]}),(0,a.jsxs)(R.Xi,{onClick:()=>eS("pdf"),children:[(0,a.jsx)(T.Z,{className:"mr-2 h-4 w-4"}),"Export as PDF"]}),(0,a.jsx)(R.VD,{}),(0,a.jsxs)(R.Xi,{onClick:eI,children:[(0,a.jsx)(A.Z,{className:"mr-2 h-4 w-4"}),"Share Tree"]})]})]})]}),ex&&ep.length>0&&(0,a.jsx)("div",{className:"absolute top-full mt-2 left-0 right-0 bg-white/95 dark:bg-gray-800/95 backdrop-blur-md rounded-lg shadow-lg border border-white/20 dark:border-gray-700/20 max-h-64 overflow-y-auto",children:ep.map(e=>(0,a.jsxs)("button",{onClick:()=>ek(e),className:"w-full px-4 py-3 text-left hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors border-b border-gray-100 dark:border-gray-700 last:border-b-0 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-sm font-medium",children:e.name.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:e.name}),e.email&&(0,a.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.email})]})]},e.id))})]})}),(0,a.jsxs)("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2 transition-opacity duration-200 ".concat(h?"opacity-0 pointer-events-none":"opacity-100"),style:{zIndex:h?10:1e3,pointerEvents:h?"none":"auto"},onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{className:"rounded-md bg-white px-3 py-2 text-sm shadow-md hover:bg-slate-100 dark:bg-slate-800 dark:hover:bg-slate-700 transition-all hover:scale-105 hover:shadow-lg",onClick:eN,children:"Reset View"}),(0,a.jsx)("button",{className:"rounded-md bg-white px-3 py-2 text-sm shadow-md hover:bg-slate-100 dark:bg-slate-800 dark:hover:bg-slate-700 transition-all hover:scale-105 hover:shadow-lg",onClick:ew,children:"Zoom In"}),(0,a.jsx)("button",{className:"rounded-md bg-white px-3 py-2 text-sm shadow-md hover:bg-slate-100 dark:bg-slate-800 dark:hover:bg-slate-700 transition-all hover:scale-105 hover:shadow-lg",onClick:eC,children:"Zoom Out"}),(0,a.jsxs)("button",{className:"rounded-md bg-white px-3 py-2 text-sm shadow-md hover:bg-slate-100 dark:bg-slate-800 dark:hover:bg-slate-700 flex items-center gap-2",onClick:eZ,title:ed?h?"Close Drawer":"Exit Fullscreen":"Enter Fullscreen",children:[ed?(0,a.jsx)(_.Z,{className:"h-4 w-4"}):(0,a.jsx)(F.Z,{className:"h-4 w-4"}),ed?h?"Close Drawer":"Exit Canvas":"Enter Canvas"]})]}),(0,a.jsx)("div",{className:"absolute top-4 right-4 transition-opacity duration-200 ".concat(h?"opacity-0 pointer-events-none":"opacity-100"),style:{zIndex:h?10:1e3,pointerEvents:h?"none":"auto"},onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:(0,a.jsx)("button",{className:"rounded-md bg-white px-3 py-2 text-sm shadow-md hover:bg-slate-100 dark:bg-slate-800 dark:hover:bg-slate-700",onClick:()=>{let e=new CustomEvent("show-tree-help");document.dispatchEvent(e)},title:"Help & Keyboard Shortcuts",children:(0,a.jsx)(D.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(S,{}),ed&&m&&g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("style",{children:"\n            /* Standardized z-index system for TreeCanvas */\n            \n            /* Dialog layers */\n            body:fullscreen [data-radix-dialog-overlay] {\n              z-index: 50 !important;\n            }\n            body:fullscreen [data-radix-dialog-content] {\n              z-index: 51 !important;\n            }\n            \n            /* Sheet layers */\n            body:fullscreen [data-radix-sheet-overlay] {\n              z-index: 40 !important;\n            }\n            body:fullscreen [data-radix-sheet-content] {\n              z-index: 41 !important;\n            }\n          "}),(0,a.jsx)(G.d,{member:m,open:h,onOpenChange:g,allMembers:t,treeId:o,isTreeCanvasPage:!0,onMemberNavigate:y,onEditClick:x,onAddSpouseClick:f,onAddChildClick:v,onAddParentClick:j})]})]})}var V=n(75060),q=n(15291),W=n(68245);function Q(e){var t,n;let{open:r,onOpenChange:l,treeId:o,relativeTo:c,defaultRelationship:d,allMembers:m=[],onSuccess:u}=e,[h,p]=(0,s.useState)(!1),[g,x]=(0,s.useState)({name:"",email:"",gender:"",dob:"",deceased:!1,relationship:d||"self",includeSecondParent:!1,selectedSecondParentId:"",becomeCoParent:!1,selectedChildrenIds:[],useExistingMember:!1,selectedExistingMemberId:""}),f=(null==c?void 0:null===(t=c.spouseIds)||void 0===t?void 0:t.map(e=>m.find(t=>t.id===e)).filter(e=>void 0!==e))||[],v=(null==c?void 0:null===(n=c.childIds)||void 0===n?void 0:n.map(e=>m.find(t=>t.id===e)).filter(e=>void 0!==e))||[],j="child"===g.relationship&&f.length>0,b="spouse"===g.relationship&&v.length>0,y=m.filter(e=>!!c&&e.id!==c.id&&("parent"===g.relationship?!c.childIds.includes(e.id)&&!e.childIds.includes(c.id):"spouse"!==g.relationship||!c.spouseIds.includes(e.id)&&!c.parentIds.includes(e.id)&&!c.childIds.includes(e.id))),w=("parent"===g.relationship||"spouse"===g.relationship)&&y.length>0;(0,s.useEffect)(()=>{j&&1===f.length&&!g.selectedSecondParentId&&x(e=>({...e,selectedSecondParentId:f[0].id,includeSecondParent:!0}))},[j,f]),(0,s.useEffect)(()=>{d&&x(e=>({...e,relationship:d}))},[d,r]);let C=async e=>{e.preventDefault(),p(!0);try{let e;let t="http://localhost:8050/api";if(g.useExistingMember&&g.selectedExistingMemberId)e={id:g.selectedExistingMemberId};else{let n={name:g.name,email:g.email||void 0,gender:g.gender||void 0,dob:g.dob||void 0,deceased:g.deceased},a=await fetch("".concat(t,"/trees/").concat(o,"/members"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)});if(!a.ok)throw Error("Failed to create member");e=await a.json()}if(c&&"self"!==g.relationship){let n="";switch(g.relationship){case"parent":n="".concat(t,"/members/").concat(e.id,"/children?child_id=").concat(c.id),console.log("[AddMember] Adding parent ".concat(g.useExistingMember?"existing member":e.name||g.name," to child ").concat(c.name));break;case"child":if(j&&g.includeSecondParent){if(!g.selectedSecondParentId)throw Error('Please select a second parent or uncheck "Add second parent"');n="".concat(t,"/members/").concat(c.id,"/children?child_id=").concat(e.id,"&second_parent_id=").concat(g.selectedSecondParentId)}else n="".concat(t,"/members/").concat(c.id,"/children?child_id=").concat(e.id);break;case"spouse":n="".concat(t,"/members/").concat(c.id,"/spouse?spouse_id=").concat(e.id)}if(n){let e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok){let t=await e.json().catch(()=>null);throw console.error("Failed to create relationship:",t),Error("Failed to create relationship: ".concat((null==t?void 0:t.detail)||e.statusText))}}if("spouse"===g.relationship&&g.becomeCoParent&&g.selectedChildrenIds.length>0)for(let n of g.selectedChildrenIds){let a="".concat(t,"/members/").concat(e.id,"/children?child_id=").concat(n),s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>null);console.error("Failed to create co-parent relationship:",e),console.warn("Could not add co-parent relationship with child ".concat(n,": ").concat((null==e?void 0:e.detail)||s.statusText))}}}x({name:"",email:"",gender:"",dob:"",deceased:!1,relationship:"self",includeSecondParent:!1,selectedSecondParentId:"",becomeCoParent:!1,selectedChildrenIds:[],useExistingMember:!1,selectedExistingMemberId:""}),l(!1),null==u||u()}catch(e){console.error("Error adding member:",e),alert("Failed to add member. Please try again.")}finally{p(!1)}};return(0,a.jsx)(k.Vq,{open:r,onOpenChange:l,children:(0,a.jsx)(k.cZ,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("form",{onSubmit:C,children:[(0,a.jsxs)(k.fK,{children:[(0,a.jsx)(k.$N,{children:(()=>{if(!c)return"Add First Member";let e=g.useExistingMember?"Connect":"Add";switch(g.relationship){case"parent":return"".concat(e," Parent ").concat(g.useExistingMember?"to":"of"," ").concat(c.name);case"child":return"".concat(e," Child ").concat(g.useExistingMember?"to":"of"," ").concat(c.name);case"spouse":return"".concat(e," Spouse ").concat(g.useExistingMember?"to":"of"," ").concat(c.name);default:return"Add Family Member"}})()}),(0,a.jsx)(k.Be,{children:c?g.useExistingMember?"Select an existing family member to create a ".concat(g.relationship," relationship"):"Fill in the details to add a new family member":"Add yourself or the oldest known ancestor to start your family tree"})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[c&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(V._,{htmlFor:"relationship",children:["Relationship to ",c.name]}),(0,a.jsxs)(q.Ph,{value:g.relationship,onValueChange:e=>x({...g,relationship:e,useExistingMember:!1,selectedExistingMemberId:""}),children:[(0,a.jsx)(q.i4,{id:"relationship",children:(0,a.jsx)(q.ki,{})}),(0,a.jsxs)(q.Bw,{children:[(0,a.jsx)(q.Ql,{value:"parent",children:"Parent"}),(0,a.jsx)(q.Ql,{value:"spouse",children:"Spouse"}),(0,a.jsx)(q.Ql,{value:"child",children:"Child"})]})]})]}),w&&(0,a.jsxs)("div",{className:"space-y-3 rounded-md border border-purple-200 bg-purple-50 p-4 dark:border-purple-900 dark:bg-purple-950",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(W.X,{id:"useExistingMember",checked:g.useExistingMember,onCheckedChange:e=>x({...g,useExistingMember:e,selectedExistingMemberId:""})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(V._,{htmlFor:"useExistingMember",className:"cursor-pointer text-sm font-medium",children:"Use existing family member"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Select someone already in the tree instead of creating a new member"})]})]}),g.useExistingMember&&(0,a.jsxs)("div",{className:"space-y-2 pl-6",children:[(0,a.jsx)(V._,{htmlFor:"existingMember",className:"text-sm",children:"Select Existing Member"}),(0,a.jsxs)(q.Ph,{value:g.selectedExistingMemberId,onValueChange:e=>x({...g,selectedExistingMemberId:e}),children:[(0,a.jsx)(q.i4,{id:"existingMember",children:(0,a.jsx)(q.ki,{placeholder:"Choose existing member..."})}),(0,a.jsx)(q.Bw,{children:y.map(e=>(0,a.jsxs)(q.Ql,{value:e.id,children:[e.name," ",e.gender?"(".concat(e.gender,")"):""]},e.id))})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["This will create a ",g.relationship," relationship with the selected member"]})]})]}),c&&"parent"===g.relationship&&c.parentIds&&c.parentIds.length>0&&(0,a.jsx)("div",{className:"space-y-3 rounded-md border border-amber-200 bg-amber-50 p-4 dark:border-amber-900 dark:bg-amber-950",children:(0,a.jsx)("div",{className:"flex items-start space-x-2",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-amber-800 dark:text-amber-200",children:"Adding Co-Parent"}),(0,a.jsxs)("p",{className:"text-xs text-amber-700 dark:text-amber-300 mt-1",children:[c.name," already has"," ",c.parentIds.length," parent",c.parentIds.length>1?"s":"",". The new parent will be placed in the same generation as the existing parent",c.parentIds.length>1?"s":"","to maintain proper family tree structure."]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)("p",{className:"text-xs font-medium text-amber-800 dark:text-amber-200",children:["Existing parent",c.parentIds.length>1?"s":"",":"]}),(0,a.jsx)("ul",{className:"text-xs text-amber-700 dark:text-amber-300 ml-2",children:c.parentIds.map(e=>{let t=m.find(t=>t.id===e);return(0,a.jsxs)("li",{children:["• ",(null==t?void 0:t.name)||"Unknown"]},e)})})]})]})})}),j&&(0,a.jsxs)("div",{className:"space-y-3 rounded-md border border-blue-200 bg-blue-50 p-4 dark:border-blue-900 dark:bg-blue-950",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(W.X,{id:"includeSecondParent",checked:g.includeSecondParent,onCheckedChange:e=>x({...g,includeSecondParent:e})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(V._,{htmlFor:"includeSecondParent",className:"cursor-pointer text-sm font-medium",children:"Add second parent"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Select which spouse/partner will be the other parent"})]})]}),g.includeSecondParent&&(0,a.jsxs)("div",{className:"space-y-2 pl-6",children:[(0,a.jsx)(V._,{htmlFor:"secondParent",className:"text-sm",children:"Second Parent"}),(0,a.jsxs)(q.Ph,{value:g.selectedSecondParentId,onValueChange:e=>x({...g,selectedSecondParentId:e}),children:[(0,a.jsx)(q.i4,{id:"secondParent",children:(0,a.jsx)(q.ki,{placeholder:"Select second parent"})}),(0,a.jsx)(q.Bw,{children:f.map(e=>(0,a.jsxs)(q.Ql,{value:e.id,children:[e.name," ",e.gender?"(".concat(e.gender,")"):""]},e.id))})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["This will create parent-child relationships with both"," ",null==c?void 0:c.name," and the selected parent"]})]})]}),b&&(0,a.jsxs)("div",{className:"space-y-3 rounded-md border border-green-200 bg-green-50 p-4 dark:border-green-900 dark:bg-green-950",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(W.X,{id:"becomeCoParent",checked:g.becomeCoParent,onCheckedChange:e=>{x({...g,becomeCoParent:e,selectedChildrenIds:e?v.map(e=>e.id):[]})}}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(V._,{htmlFor:"becomeCoParent",className:"cursor-pointer text-sm font-medium",children:"Become co-parent to existing children"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Add this spouse as a parent to ",null==c?void 0:c.name,"'s existing children"]})]})]}),g.becomeCoParent&&(0,a.jsxs)("div",{className:"space-y-2 pl-6",children:[(0,a.jsx)(V._,{className:"text-sm",children:"Children to become parent of:"}),(0,a.jsx)("div",{className:"space-y-2",children:v.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(W.X,{id:"child-".concat(e.id),checked:g.selectedChildrenIds.includes(e.id),onCheckedChange:t=>{let n=t?[...g.selectedChildrenIds,e.id]:g.selectedChildrenIds.filter(t=>t!==e.id);x({...g,selectedChildrenIds:n})}}),(0,a.jsxs)(V._,{htmlFor:"child-".concat(e.id),className:"cursor-pointer text-sm",children:[e.name," ",e.gender?"(".concat(e.gender,")"):""]})]},e.id))}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"This will create parent-child relationships between the new spouse and selected children"})]})]}),!g.useExistingMember&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"name",children:"Name *"}),(0,a.jsx)(L.I,{id:"name",placeholder:"Full name",value:g.name,onChange:e=>x({...g,name:e.target.value}),required:!0})]}),!g.useExistingMember&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"gender",children:"Gender"}),(0,a.jsxs)(q.Ph,{value:g.gender,onValueChange:e=>x({...g,gender:e}),children:[(0,a.jsx)(q.i4,{id:"gender",children:(0,a.jsx)(q.ki,{placeholder:"Select gender"})}),(0,a.jsxs)(q.Bw,{children:[(0,a.jsx)(q.Ql,{value:"male",children:"Male"}),(0,a.jsx)(q.Ql,{value:"female",children:"Female"}),(0,a.jsx)(q.Ql,{value:"unspecified",children:"Prefer not to say"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"dob",children:"Date of Birth"}),(0,a.jsx)(L.I,{id:"dob",type:"date",value:g.dob,onChange:e=>x({...g,dob:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"email",children:"Email (optional)"}),(0,a.jsx)(L.I,{id:"email",type:"email",placeholder:"email@example.com",value:g.email,onChange:e=>x({...g,email:e.target.value})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(W.X,{id:"deceased",checked:g.deceased,onCheckedChange:e=>x({...g,deceased:e})}),(0,a.jsx)(V._,{htmlFor:"deceased",className:"cursor-pointer text-sm font-normal",children:"Deceased"})]})]})]}),(0,a.jsxs)(k.cN,{children:[(0,a.jsx)(i.z,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancel"}),(0,a.jsxs)(i.z,{type:"submit",disabled:h||!g.useExistingMember&&!g.name.trim()||g.useExistingMember&&!g.selectedExistingMemberId,children:[h&&(0,a.jsx)(I.Z,{className:"mr-2 h-4 w-4 animate-spin"}),g.useExistingMember?"Add Relationship":"Add Member"]})]})]})})})}var $=n(30767),J=n(23675),ee=n(31593),et=n(48837),en=n(32489),ea=n(37806),es=n(63639),er=n(24945);function ei(e){let{open:t,onOpenChange:n,member:r,allMembers:l,treeSettings:c,onSuccess:d,onMemberUpdate:m}=e,{toast:h}=(0,u.pm)(),[p,g]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),[v,j]=(0,s.useState)(null),[b,y]=(0,s.useState)(null),[w,C]=(0,s.useState)({name:"",email:"",avatar_url:"",gender:"",pronouns:"",dob:"",dod:"",deceased:!1,birth_place:"",death_place:"",occupation:"",bio:"",notes:""}),[N,E]=(0,s.useState)([]),[D,S]=(0,s.useState)([]),[M,P]=(0,s.useState)(""),[A,T]=(0,s.useState)("");if((0,s.useEffect)(()=>{r&&(C({name:r.name||"",email:r.email||"",avatar_url:r.avatar_url||"",gender:r.gender||"",pronouns:r.pronouns||"",dob:r.dob||"",dod:r.dod||"",deceased:r.deceased||!1,birth_place:r.birth_place||"",death_place:r.death_place||"",occupation:r.occupation||"",bio:r.bio||"",notes:r.notes||""}),E(r.parentIds||[]),S(r.spouseIds||[]))},[r]),!r)return null;let _=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(t.has(e))return 0;t.add(e);let n=l.find(t=>t.id===e);if(!n||0===n.parentIds.length)return 0;let a=n.parentIds.map(e=>_(e,t)).filter(e=>null!==e);return a.length>0?Math.max(...a)+1:0},F=e=>{let t=_(r.id);return _(e)>=t?{type:"generation_mismatch",message:"Generation mismatch: The selected parent is in the same or later generation as ".concat(r.name,"."),consequences:"This may cause layout issues and logical inconsistencies in the family tree. The tree structure may not reflect accurate generational relationships."}:null},G=e=>{let t=c.maxParentsPerChild||1/0;return e>t?{type:"max_exceeded",message:"Maximum parents exceeded: This tree allows a maximum of ".concat(t," parent(s) per child."),consequences:"".concat(r.name," currently has ").concat(N.length," parent(s). Adding more would violate tree settings.")}:null},R=e=>{if(c.monogamy&&e>1)return{type:"max_exceeded",message:"Monogamy enforced: This tree only allows one spouse per member.",consequences:"".concat(r.name," already has a spouse. Remove existing spouse before adding a new one.")};let t=c.maxSpousesPerMember||1/0;return e>t?{type:"max_exceeded",message:"Maximum spouses exceeded: This tree allows a maximum of ".concat(t," spouse(s) per member."),consequences:"".concat(r.name," would have ").concat(e," spouse(s), which exceeds the limit.")}:null},z=e=>{let t=function(e,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;if(a.has(n))return!1;a.add(n);let s=l.find(e=>e.id===n);return!!s&&(!!s.parentIds.includes(e)||s.parentIds.some(n=>t(e,n,a)))};return t(r.id,e)?{type:"circular_relationship",message:"Circular relationship detected: The selected parent is a descendant of this member.",consequences:"This would create a logical impossibility (parent being their own ancestor/descendant)."}:null},Z=async e=>{let t=z(e);if(t){j(t),f(!0);return}let n=G(N.length+1);if(n){h({title:"Cannot Add Parent",description:n.message,variant:"destructive"});return}let a=F(e);if(a){j(a),y(()=>async()=>{await O(e)}),f(!0);return}await O(e)},O=async e=>{try{if(!(await fetch("".concat("http://localhost:8050/api","/members/").concat(e,"/children?child_id=").concat(r.id),{method:"POST",credentials:"include"})).ok)throw Error("Failed to add parent relationship");E([...N,e]),h({title:"Parent Added",description:"Parent relationship created successfully"}),null==d||d()}catch(e){h({title:"Error",description:"Failed to add parent relationship",variant:"destructive"})}},B=async e=>{try{if(!(await fetch("".concat("http://localhost:8050/api","/members/").concat(e,"/children/").concat(r.id),{method:"DELETE",credentials:"include"})).ok)throw Error("Failed to remove parent relationship");E(N.filter(t=>t!==e)),h({title:"Parent Removed",description:"Parent relationship removed successfully"}),null==d||d()}catch(e){h({title:"Error",description:"Failed to remove parent relationship",variant:"destructive"})}},Y=async e=>{let t=R(D.length+1);if(t){h({title:"Cannot Add Spouse",description:t.message,variant:"destructive"});return}try{if(!(await fetch("".concat("http://localhost:8050/api","/members/").concat(r.id,"/spouse?spouse_id=").concat(e),{method:"POST",credentials:"include"})).ok)throw Error("Failed to add spouse relationship");S([...D,e]),h({title:"Spouse Added",description:"Spouse relationship created successfully"}),null==d||d()}catch(e){h({title:"Error",description:"Failed to add spouse relationship",variant:"destructive"})}},U=async()=>{if(!M.trim()){h({title:"Validation Error",description:"Please enter spouse name",variant:"destructive"});return}let e=R(D.length+1);if(e){h({title:"Cannot Add Spouse",description:e.message,variant:"destructive"});return}try{g(!0);let e="http://localhost:8050/api",t=await fetch("".concat(e,"/trees/").concat(r.tree_id,"/members"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:M.trim(),gender:A||void 0,deceased:!1})});if(!t.ok)throw Error("Failed to create spouse member");let n=await t.json();if(!(await fetch("".concat(e,"/members/").concat(r.id,"/spouse?spouse_id=").concat(n.id),{method:"POST",credentials:"include"})).ok)throw Error("Failed to create spouse relationship");S([...D,n.id]),P(""),T(""),h({title:"Spouse Added",description:"".concat(M," has been added as spouse")}),null==d||d()}catch(e){h({title:"Error",description:"Failed to add new spouse",variant:"destructive"})}finally{g(!1)}},K=async e=>{try{if(!(await fetch("".concat("http://localhost:8050/api","/members/").concat(r.id,"/spouse/").concat(e),{method:"DELETE",credentials:"include"})).ok)throw Error("Failed to remove spouse relationship");S(D.filter(t=>t!==e)),h({title:"Spouse Removed",description:"Spouse relationship removed successfully"}),null==d||d()}catch(e){h({title:"Error",description:"Failed to remove spouse relationship",variant:"destructive"})}},X=async()=>{try{var e,t,n,a,s,i,l,o,c,m,u,p;g(!0);let x={};if((null===(e=w.name)||void 0===e?void 0:e.trim())&&(x.name=w.name.trim()),(null===(t=w.email)||void 0===t?void 0:t.trim())&&(x.email=w.email.trim()),(null===(n=w.avatar_url)||void 0===n?void 0:n.trim())&&(x.avatar_url=w.avatar_url.trim()),(null===(a=w.gender)||void 0===a?void 0:a.trim())&&(x.gender=w.gender.trim()),(null===(s=w.pronouns)||void 0===s?void 0:s.trim())&&(x.pronouns=w.pronouns.trim()),(null===(i=w.dob)||void 0===i?void 0:i.trim())&&(x.dob=w.dob.trim()),(null===(l=w.dod)||void 0===l?void 0:l.trim())&&(x.dod=w.dod.trim()),(null===(o=w.birth_place)||void 0===o?void 0:o.trim())&&(x.birth_place=w.birth_place.trim()),(null===(c=w.death_place)||void 0===c?void 0:c.trim())&&(x.death_place=w.death_place.trim()),(null===(m=w.occupation)||void 0===m?void 0:m.trim())&&(x.occupation=w.occupation.trim()),(null===(u=w.bio)||void 0===u?void 0:u.trim())&&(x.bio=w.bio.trim()),(null===(p=w.notes)||void 0===p?void 0:p.trim())&&(x.notes=w.notes.trim()),x.deceased=w.deceased,!x.name){h({title:"Validation Error",description:"Name is required",variant:"destructive"});return}console.log("Sending member update payload:",x);let f=await fetch("".concat("http://localhost:8050/api","/members/").concat(r.id),{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(x)});if(!f.ok){let e=await f.json().catch(()=>({}));throw console.error("Member update failed:",f.status,e),Error(e.message||"Failed to update member (".concat(f.status,")"))}h({title:"Success",description:"Member updated successfully"}),null==d||d()}catch(e){console.error("Error updating member:",e),h({title:"Error",description:e instanceof Error?e.message:"Failed to update member",variant:"destructive"})}finally{g(!1)}},H=l.filter(e=>e.id!==r.id&&!N.includes(e.id)&&!r.childIds.includes(e.id)),Q=l.filter(e=>e.id!==r.id&&!D.includes(e.id)&&!r.parentIds.includes(e.id)&&!r.childIds.includes(e.id));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Vq,{open:t,onOpenChange:n,children:(0,a.jsxs)(k.cZ,{className:"max-w-3xl max-h-[95vh] sm:max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)(k.fK,{children:[(0,a.jsxs)(k.$N,{children:["Edit ",r.name]}),(0,a.jsx)(k.Be,{children:"Update member information and manage relationships"})]}),(0,a.jsxs)("div",{className:"space-y-6 py-4 flex-1 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Basic Information"}),(0,a.jsx)("div",{className:"flex justify-center py-4",children:(0,a.jsx)(er.G,{currentAvatarUrl:w.avatar_url,userInitials:r.name.split(" ").map(e=>e[0]).join("").slice(0,2),onAvatarChange:e=>{C({...w,avatar_url:e||""}),null==m||m()},uploadEndpoint:"".concat("http://localhost:8050/api","/members/").concat(r.id,"/avatar"),deleteEndpoint:"".concat("http://localhost:8050/api","/members/").concat(r.id,"/avatar"),size:"lg"})}),(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"name",children:"Name *"}),(0,a.jsx)(L.I,{id:"name",value:w.name,onChange:e=>C({...w,name:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"email",children:"Email"}),(0,a.jsx)(L.I,{id:"email",type:"email",value:w.email,onChange:e=>C({...w,email:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"gender",children:"Gender"}),(0,a.jsxs)(q.Ph,{value:w.gender,onValueChange:e=>C({...w,gender:e}),children:[(0,a.jsx)(q.i4,{id:"gender",children:(0,a.jsx)(q.ki,{placeholder:"Select gender"})}),(0,a.jsxs)(q.Bw,{children:[(0,a.jsx)(q.Ql,{value:"male",children:"Male"}),(0,a.jsx)(q.Ql,{value:"female",children:"Female"}),(0,a.jsx)(q.Ql,{value:"non-binary",children:"Non-binary"}),(0,a.jsx)(q.Ql,{value:"other",children:"Other"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"pronouns",children:"Pronouns"}),(0,a.jsx)(L.I,{id:"pronouns",value:w.pronouns,onChange:e=>C({...w,pronouns:e.target.value}),placeholder:"they/them, she/her, he/him"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"dob",children:"Date of Birth"}),(0,a.jsx)(L.I,{id:"dob",type:"date",value:w.dob,onChange:e=>C({...w,dob:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"occupation",children:"Occupation"}),(0,a.jsx)(L.I,{id:"occupation",value:w.occupation,onChange:e=>C({...w,occupation:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"birth_place",children:"Birth Place"}),(0,a.jsx)(L.I,{id:"birth_place",value:w.birth_place,onChange:e=>C({...w,birth_place:e.target.value}),placeholder:"City, Country"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(W.X,{id:"deceased",checked:w.deceased,onCheckedChange:e=>C({...w,deceased:e})}),(0,a.jsx)(V._,{htmlFor:"deceased",className:"cursor-pointer",children:"Deceased"})]}),w.deceased&&(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"dod",children:"Date of Death"}),(0,a.jsx)(L.I,{id:"dod",type:"date",value:w.dod,onChange:e=>C({...w,dod:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"death_place",children:"Death Place"}),(0,a.jsx)(L.I,{id:"death_place",value:w.death_place,onChange:e=>C({...w,death_place:e.target.value}),placeholder:"City, Country"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"bio",children:"Biography"}),(0,a.jsx)(J.g,{id:"bio",value:w.bio,onChange:e=>C({...w,bio:e.target.value}),placeholder:"Brief biography or life story...",rows:3})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V._,{htmlFor:"notes",children:"Notes"}),(0,a.jsx)(J.g,{id:"notes",value:w.notes,onChange:e=>C({...w,notes:e.target.value}),placeholder:"Additional notes or information...",rows:3})]})]}),(0,a.jsxs)(i.z,{onClick:X,disabled:p,children:[p&&(0,a.jsx)(I.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Basic Info"]})]}),(0,a.jsx)(ee.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Parents"}),(0,a.jsxs)(o.C,{variant:"outline",children:[N.length," /"," ",c.maxParentsPerChild||"∞"]})]}),(0,a.jsx)("div",{className:"space-y-2",children:N.map(e=>{let t=l.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-3",children:[(0,a.jsx)("span",{children:t.name}),(0,a.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>B(e),children:(0,a.jsx)(et.Z,{className:"h-4 w-4"})})]},e):null})}),H.length>0&&(0,a.jsxs)(q.Ph,{onValueChange:Z,children:[(0,a.jsx)(q.i4,{children:(0,a.jsx)(q.ki,{placeholder:"Add parent from tree..."})}),(0,a.jsx)(q.Bw,{children:H.map(e=>(0,a.jsx)(q.Ql,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsx)(ee.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Spouses"}),(0,a.jsxs)(o.C,{variant:"outline",children:[D.length," /"," ",c.monogamy?"1":c.maxSpousesPerMember||"∞"]})]}),(0,a.jsx)("div",{className:"space-y-2",children:D.map(e=>{let t=l.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-3",children:[(0,a.jsx)("span",{children:t.name}),(0,a.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>K(e),children:(0,a.jsx)(en.Z,{className:"h-4 w-4"})})]},e):null})}),Q.length>0&&(0,a.jsxs)(q.Ph,{onValueChange:Y,children:[(0,a.jsx)(q.i4,{children:(0,a.jsx)(q.ki,{placeholder:"Add existing member as spouse..."})}),(0,a.jsx)(q.Bw,{children:Q.map(e=>(0,a.jsx)(q.Ql,{value:e.id,children:e.name},e.id))})]}),(0,a.jsxs)("div",{className:"rounded-md border p-4 space-y-3",children:[(0,a.jsx)(V._,{children:"Or add new spouse to tree"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(L.I,{placeholder:"Spouse name",value:M,onChange:e=>P(e.target.value)}),(0,a.jsxs)(q.Ph,{value:A,onValueChange:T,children:[(0,a.jsx)(q.i4,{className:"w-[140px]",children:(0,a.jsx)(q.ki,{placeholder:"Gender"})}),(0,a.jsxs)(q.Bw,{children:[(0,a.jsx)(q.Ql,{value:"male",children:"Male"}),(0,a.jsx)(q.Ql,{value:"female",children:"Female"}),(0,a.jsx)(q.Ql,{value:"other",children:"Other"})]})]}),(0,a.jsx)(i.z,{onClick:U,disabled:p,children:(0,a.jsx)(ea.Z,{className:"h-4 w-4"})})]})]})]})]}),(0,a.jsx)(k.cN,{children:(0,a.jsx)(i.z,{variant:"outline",onClick:()=>n(!1),children:"Close"})})]})}),(0,a.jsx)($.aR,{open:x,onOpenChange:f,children:(0,a.jsxs)($._T,{children:[(0,a.jsxs)($.fY,{children:[(0,a.jsxs)($.f$,{className:"flex items-center gap-2",children:[(0,a.jsx)(es.Z,{className:"h-5 w-5 text-yellow-500"}),"Validation Warning"]}),(0,a.jsxs)($.yT,{className:"space-y-2",children:[(0,a.jsx)("p",{className:"font-semibold",children:null==v?void 0:v.message}),(0,a.jsx)("p",{className:"text-sm",children:null==v?void 0:v.consequences}),(0,a.jsx)("p",{className:"text-sm font-medium mt-4",children:"Do you want to proceed anyway?"})]})]}),(0,a.jsxs)($.xo,{children:[(0,a.jsx)($.le,{onClick:()=>{f(!1),y(null),j(null)},children:"Cancel"}),(0,a.jsx)($.OL,{onClick:async()=>{b&&await b(),f(!1),y(null),j(null)},children:"Proceed Anyway"})]})]})})]})}var el=n(85040),eo=n(37511),ec=n(98728),ed=n(13420),em=n(95805),eu=n(33245),eh=n(53057),ep=n(40257);function eg(){var e,t,n,h,p,g,x,f,v,j,b,y;let w=(0,r.useParams)(),C=(0,r.useRouter)(),{toast:N}=(0,u.pm)(),[E,k]=(0,s.useState)(null),[D,S]=(0,s.useState)(!0),[M,P]=(0,s.useState)(null),[A,T]=(0,s.useState)(!1),[_,F]=(0,s.useState)(!1),[L,R]=(0,s.useState)(!1),[z,Z]=(0,s.useState)(void 0),[O,B]=(0,s.useState)(void 0),[Y,U]=(0,s.useState)(!1),[K,V]=(0,s.useState)(!1),[q,W]=(0,s.useState)(null),$=w.id;(0,X.Il)($);let{members:J,loading:ee,error:et,refetch:en}=(0,eo.r)({treeId:$,autoFetch:!0});(0,s.useEffect)(()=>{es()},[$]),(0,s.useEffect)(()=>{let e=()=>{U(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);let es=async()=>{try{S(!0);let e=await fetch("".concat("http://localhost:8050/api","/trees/").concat($),{credentials:"include"});if(!e.ok){if(404===e.status){N({title:"Tree Not Found",description:"The requested tree does not exist or you do not have access to it.",variant:"destructive"}),C.push("/trees");return}throw Error("Failed to fetch tree")}let t=await e.json();k(t)}catch(e){console.error("Error fetching tree:",e),N({title:"Error",description:"Failed to load tree details. Please try again.",variant:"destructive"})}finally{S(!1)}};if(D)return(0,a.jsx)(m.c,{children:(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(I.Z,{className:"h-12 w-12 animate-spin text-primary mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading tree..."})]})})});if(!E)return null;let er="custodian"===E.user_role,eg="custodian"===E.user_role||"contributor"===E.user_role,ex=e=>{let t=J.find(t=>t.id===e);t&&P(t)},ef=(e,t)=>{Z(e),B(t),F(!0)};return(0,a.jsxs)(m.c,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:E.name}),(0,a.jsx)(o.C,{variant:"custodian"===E.user_role?"default":"contributor"===E.user_role?"secondary":"outline",children:E.user_role})]}),E.description&&(0,a.jsx)("p",{className:"text-muted-foreground",children:E.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[eg&&(0,a.jsxs)(i.z,{variant:"outline",onClick:()=>ef(),children:[(0,a.jsx)(ea.Z,{className:"h-4 w-4 mr-2"}),"Add Member"]}),er&&(0,a.jsxs)(i.z,{variant:"outline",onClick:()=>C.push("/trees/".concat($,"/settings")),children:[(0,a.jsx)(ec.Z,{className:"h-4 w-4 mr-2"}),"Settings"]})]})]}),(0,a.jsxs)(c.mQ,{defaultValue:"visualization",className:"space-y-4",children:[(0,a.jsxs)(c.dr,{children:[(0,a.jsxs)(c.SP,{value:"visualization",children:[(0,a.jsx)(ed.Z,{className:"h-4 w-4 mr-2"}),"Tree View"]}),(0,a.jsxs)(c.SP,{value:"members",children:[(0,a.jsx)(em.Z,{className:"h-4 w-4 mr-2"}),"Members (",J.length,")"]}),(0,a.jsxs)(c.SP,{value:"info",children:[(0,a.jsx)(eu.Z,{className:"h-4 w-4 mr-2"}),"Information"]})]}),(0,a.jsx)(c.nU,{value:"visualization",className:"space-y-4",children:(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsx)(l.ll,{children:"Family Tree Visualization"}),(0,a.jsx)(l.SZ,{children:"Interactive view of your family tree with all members and relationships. Click and drag to pan, scroll to zoom, click members to view details."})]}),(0,a.jsx)(l.aY,{className:"p-0",children:ee?(0,a.jsx)("div",{className:"flex h-[600px] items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(I.Z,{className:"mx-auto mb-4 h-12 w-12 animate-spin text-primary"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading family tree..."})]})}):et?(0,a.jsx)("div",{className:"flex h-[600px] items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(eh.Z,{className:"mx-auto mb-4 h-16 w-16 text-destructive"}),(0,a.jsx)("h3",{className:"mb-2 text-xl font-semibold",children:"Error Loading Tree"}),(0,a.jsx)("p",{className:"mb-6 text-muted-foreground",children:et.message}),(0,a.jsx)(i.z,{onClick:()=>en(),children:"Try Again"})]})}):0===J.length?(0,a.jsx)("div",{className:"relative flex h-[600px] items-center justify-center border-2 border-dashed",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(eh.Z,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground"}),(0,a.jsx)("h3",{className:"mb-2 text-xl font-semibold",children:"Start Building Your Family Tree"}),(0,a.jsx)("p",{className:"mb-6 max-w-md text-muted-foreground",children:"Add yourself as the first member to begin creating your tree. You can then add parents, spouses, children, and siblings to build out your family history."}),eg&&(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,a.jsxs)(i.z,{onClick:()=>ef(),size:"lg",children:[(0,a.jsx)(ea.Z,{className:"mr-2 h-5 w-5"}),"Add Yourself"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"You'll be the root of this family tree"})]})]})}):(0,a.jsxs)("div",{className:"relative h-[600px] w-full",children:[(0,a.jsx)(H,{members:J,selectedMemberId:null==M?void 0:M.id,onMemberClick:e=>{P(e),T(!0)},onCenterOnMember:ex,treeId:$,selectedMember:M,drawerOpen:A,onDrawerOpenChange:T,onEditClick:()=>{T(!1),R(!0)},onAddSpouseClick:()=>{T(!1),ef(M||void 0,"spouse")},onAddChildClick:()=>{T(!1),ef(M||void 0,"child")},onAddParentClick:()=>{T(!1),ef(M||void 0,"parent")},onMemberNavigate:e=>{P(e),ex(e.id)},onRelationshipAnalyze:(e,t)=>{W({fromMemberId:e,toMemberId:t});let n=J.find(t=>t.id===e);n&&P(n),V(!0)}}),eg&&(0,a.jsx)("div",{className:"absolute bottom-4 left-4 z-10",children:(0,a.jsxs)(i.z,{onClick:()=>ef(),size:"lg",className:"shadow-lg",children:[(0,a.jsx)(ea.Z,{className:"mr-2 h-5 w-5"}),"Add Member"]})})]})})]})}),(0,a.jsx)(c.nU,{value:"members",className:"space-y-4",children:(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsx)(l.ll,{children:"Family Members"}),(0,a.jsx)(l.SZ,{children:"Browse and manage all members in this family tree"})]}),(0,a.jsx)(l.aY,{children:ee?(0,a.jsx)("div",{className:"flex h-[200px] items-center justify-center",children:(0,a.jsx)(I.Z,{className:"h-8 w-8 animate-spin text-primary"})}):0===J.length?(0,a.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-12 text-center",children:[(0,a.jsx)(em.Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"No Members Yet"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-6",children:"Start by adding family members to build your tree"}),eg&&(0,a.jsxs)(i.z,{onClick:()=>C.push("/trees/".concat($,"/members/new")),children:[(0,a.jsx)(ea.Z,{className:"h-4 w-4 mr-2"}),"Add Member"]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[J.length," member",1!==J.length?"s":""," ","in this tree"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[J.length>=2&&(0,a.jsxs)(i.z,{variant:"outline",onClick:()=>C.push("/trees/".concat($,"/relationships")),children:[(0,a.jsx)(ed.Z,{className:"h-4 w-4 mr-2"}),"Analyze Relationships"]}),(0,a.jsx)(i.z,{variant:"outline",onClick:()=>C.push("/trees/".concat($,"/members")),children:"View All Members"})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:J.slice(0,6).map(e=>(0,a.jsx)(l.Zb,{className:"cursor-pointer hover:border-primary/50",onClick:()=>{P(e),T(!0)},children:(0,a.jsx)(l.aY,{className:"p-3",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 text-center",children:[(0,a.jsxs)(d.qE,{className:"h-12 w-12",children:[(0,a.jsx)(d.F$,{src:e.avatar_url?"".concat(ep.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:8050").concat(e.avatar_url):void 0,alt:e.name}),(0,a.jsx)(d.Q5,{className:"bg-blue-400 text-white font-semibold",children:e.name.split(" ").map(e=>e[0]).join("").slice(0,2)})]}),(0,a.jsx)("p",{className:"text-xs font-medium line-clamp-2",children:e.name})]})})},e.id))}),J.length>6&&(0,a.jsx)("div",{className:"text-center pt-2",children:(0,a.jsxs)(i.z,{variant:"link",onClick:()=>C.push("/trees/".concat($,"/members")),children:["View all ",J.length," members →"]})})]})})]})}),(0,a.jsx)(c.nU,{value:"info",className:"space-y-4",children:(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsx)(l.ll,{children:"Tree Information"}),(0,a.jsx)(l.SZ,{children:"Details about this family tree and its settings"})]}),(0,a.jsxs)(l.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Inclusive Settings"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Same-Sex Relationships"}),(0,a.jsx)(o.C,{variant:(null===(e=E.settings)||void 0===e?void 0:e.allowSameSex)?"default":"outline",children:(null===(t=E.settings)||void 0===t?void 0:t.allowSameSex)?"Allowed":"Not Allowed"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Polygamy"}),(0,a.jsx)(o.C,{variant:(null===(n=E.settings)||void 0===n?void 0:n.allowPolygamy)?"default":"outline",children:(null===(h=E.settings)||void 0===h?void 0:h.allowPolygamy)?"Allowed":"Not Allowed"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Monogamy"}),(0,a.jsx)(o.C,{variant:(null===(p=E.settings)||void 0===p?void 0:p.monogamy)?"default":"outline",children:(null===(g=E.settings)||void 0===g?void 0:g.monogamy)?"Enforced":"Not Enforced"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Single Parent Families"}),(0,a.jsx)(o.C,{variant:(null===(x=E.settings)||void 0===x?void 0:x.allowSingleParent)?"default":"outline",children:(null===(f=E.settings)||void 0===f?void 0:f.allowSingleParent)?"Allowed":"Not Allowed"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Multi-Parent Children"}),(0,a.jsx)(o.C,{variant:(null===(v=E.settings)||void 0===v?void 0:v.allowMultiParentChildren)?"default":"outline",children:(null===(j=E.settings)||void 0===j?void 0:j.allowMultiParentChildren)?"Allowed":"Not Allowed"})]}),(null===(b=E.settings)||void 0===b?void 0:b.maxParentsPerChild)&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Max Parents per Child"}),(0,a.jsx)(o.C,{variant:"secondary",children:E.settings.maxParentsPerChild})]}),(null===(y=E.settings)||void 0===y?void 0:y.maxSpousesPerMember)&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Max Spouses per Member"}),(0,a.jsx)(o.C,{variant:"secondary",children:E.settings.maxSpousesPerMember})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Tree Details"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Created"}),(0,a.jsx)("span",{children:new Date(E.created_at).toLocaleDateString()})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Your Role"}),(0,a.jsx)(o.C,{variant:"custodian"===E.user_role?"default":"secondary",children:E.user_role})]})]})]})]})]})})]})]}),!Y&&(0,a.jsx)(G.d,{member:M,open:A,onOpenChange:T,allMembers:J,treeId:$,isTreeCanvasPage:!0,onMemberNavigate:e=>{P(e),ex(e.id)},onEditClick:()=>{T(!1),R(!0)},onAddSpouseClick:()=>{T(!1),ef(M||void 0,"spouse")},onAddChildClick:()=>{T(!1),ef(M||void 0,"child")},onAddParentClick:()=>{T(!1),ef(M||void 0,"parent")}}),(0,a.jsx)(ei,{open:L,onOpenChange:R,member:M,allMembers:J,treeSettings:E.settings,onSuccess:()=>{en(),R(!1),N({title:"Success",description:"Member updated successfully"})},onMemberUpdate:en}),(0,a.jsx)(Q,{open:_,onOpenChange:F,treeId:$,relativeTo:z,defaultRelationship:O,allMembers:J,onSuccess:()=>{en(),N({title:"Success",description:"Family member added successfully"})}}),q&&(0,a.jsx)(el.D,{open:K,onOpenChange:V,members:J,treeId:$,selectedMember:M})]})}},24945:function(e,t,n){"use strict";n.d(t,{G:function(){return v}});var a=n(57437),s=n(2265),r=n(37295),i=n(12381),l=n(74291),o=n(96246),c=n(53581),d=n(15863),m=n(32489),u=n(23340),h=n(40257);async function p(e,t){let n=await new Promise((t,n)=>{let a=new Image;a.addEventListener("load",()=>t(a)),a.addEventListener("error",e=>n(e)),a.src=e}),a=document.createElement("canvas"),s=a.getContext("2d");if(!s)throw Error("No 2d context");return a.width=t.width,a.height=t.height,s.drawImage(n,t.x,t.y,t.width,t.height,0,0,t.width,t.height),new Promise((e,t)=>{a.toBlob(n=>{n?e(n):t(Error("Canvas is empty"))},"image/jpeg",.85)})}let g={sm:"h-16 w-16",md:"h-20 w-20",lg:"h-24 w-24"},x={sm:"h-6 w-6",md:"h-7 w-7",lg:"h-8 w-8"},f={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-4 w-4"};function v(e){let{currentAvatarUrl:t,userInitials:n,onAvatarChange:v,uploadEndpoint:j,deleteEndpoint:b,size:y="lg"}=e,{toast:w}=(0,u.pm)(),[C,N]=(0,s.useState)(!1),[E,k]=(0,s.useState)(null),[D,S]=(0,s.useState)({x:0,y:0}),[I,M]=(0,s.useState)(1),[P,A]=(0,s.useState)(null),[T,_]=(0,s.useState)(!1),[F,G]=(0,s.useState)(!1),L=(0,s.useCallback)((e,t)=>{A(t)},[]),R=async()=>{if(E&&P){_(!0);try{let e=await p(E,P),t=new FormData;t.append("file",e,"avatar.jpg");let n=await fetch(j||"".concat("http://localhost:8050/api","/users/me/avatar"),{method:"POST",body:t,credentials:"include"});if(!n.ok){let e=await n.json();throw Error(e.detail||"Failed to upload avatar")}let a=await n.json();w({title:"Success",description:"Avatar uploaded successfully"}),v&&a.avatar_url&&v(a.avatar_url),N(!1),k(null),S({x:0,y:0}),M(1)}catch(e){console.error("Error uploading avatar:",e),w({title:"Error",description:e instanceof Error?e.message:"Failed to upload avatar",variant:"destructive"})}finally{_(!1)}}},z=async()=>{if(t){G(!0);try{let e=await fetch(b||"".concat("http://localhost:8050/api","/users/me/avatar"),{method:"DELETE",credentials:"include"});if(!e.ok){let t=await e.json();throw Error(t.detail||"Failed to delete avatar")}w({title:"Success",description:"Avatar deleted successfully"}),v&&v(null)}catch(e){console.error("Error deleting avatar:",e),w({title:"Error",description:e instanceof Error?e.message:"Failed to delete avatar",variant:"destructive"})}finally{G(!1)}}},Z=t?t.startsWith("/uploads")?"".concat(h.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:8050").concat(t):(t.startsWith("http"),t):void 0;return(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(o.qE,{className:g[y],children:[(0,a.jsx)(o.F$,{src:Z,alt:"Avatar"}),(0,a.jsx)(o.Q5,{className:"".concat("sm"===y?"text-sm":"md"===y?"text-lg":"text-2xl"," bg-primary/10"),children:n})]}),(0,a.jsxs)("label",{htmlFor:"avatar-upload",className:"absolute bottom-0 right-0 ".concat(x[y]," rounded-full bg-primary text-primary-foreground flex items-center justify-center cursor-pointer hover:bg-primary/90 transition-colors"),children:[(0,a.jsx)(c.Z,{className:f[y]}),(0,a.jsx)("input",{id:"avatar-upload",type:"file",accept:"image/*",className:"hidden",onChange:e=>{if(e.target.files&&e.target.files.length>0){let t=e.target.files[0];if(t.size>5242880){w({title:"File too large",description:"Please select an image smaller than 5MB",variant:"destructive"});return}if(!t.type.startsWith("image/")){w({title:"Invalid file type",description:"Please select an image file",variant:"destructive"});return}let n=new FileReader;n.addEventListener("load",()=>{k(n.result),N(!0)}),n.readAsDataURL(t)}}})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{htmlFor:"avatar-upload",className:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 cursor-pointer",children:"Change Avatar"}),t&&(0,a.jsx)(i.z,{variant:"outline",size:"sm",onClick:z,disabled:F,children:F?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"Remove Avatar"]})})]}),(0,a.jsx)(l.Vq,{open:C,onOpenChange:N,children:(0,a.jsxs)(l.cZ,{className:"sm:max-w-[600px]",children:[(0,a.jsxs)(l.fK,{children:[(0,a.jsx)(l.$N,{children:"Crop your avatar"}),(0,a.jsx)(l.Be,{children:"Adjust the image to fit within the circle"})]}),(0,a.jsx)("div",{className:"relative h-[400px] bg-muted rounded-lg overflow-hidden",children:E&&(0,a.jsx)(r.ZP,{image:E,crop:D,zoom:I,aspect:1,cropShape:"round",showGrid:!1,onCropChange:S,onCropComplete:L,onZoomChange:M})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"zoom",className:"text-sm font-medium",children:"Zoom"}),(0,a.jsx)("input",{id:"zoom",type:"range",min:1,max:3,step:.1,value:I,onChange:e=>M(Number(e.target.value)),className:"w-full"})]}),(0,a.jsxs)(l.cN,{children:[(0,a.jsx)(i.z,{variant:"outline",onClick:()=>{N(!1),k(null)},disabled:T,children:"Cancel"}),(0,a.jsx)(i.z,{onClick:R,disabled:T,children:T?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):"Upload"})]})]})})]})}},30767:function(e,t,n){"use strict";n.d(t,{OL:function(){return f},_T:function(){return u},aR:function(){return o},f$:function(){return g},fY:function(){return h},le:function(){return v},vW:function(){return c},xo:function(){return p},yT:function(){return x}});var a=n(57437),s=n(2265),r=n(90277),i=n(93448),l=n(12381);let o=r.fC,c=r.xz,d=r.h_,m=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.aV,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...s,ref:t})});m.displayName=r.aV.displayName;let u=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(m,{}),(0,a.jsx)(r.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...s})]})});u.displayName=r.VY.displayName;let h=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...n})};h.displayName="AlertDialogHeader";let p=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};p.displayName="AlertDialogFooter";let g=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold",n),...s})});g.displayName=r.Dx.displayName;let x=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",n),...s})});x.displayName=r.dk.displayName;let f=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.aU,{ref:t,className:(0,i.cn)((0,l.d)(),n),...s})});f.displayName=r.aU.displayName;let v=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.$j,{ref:t,className:(0,i.cn)((0,l.d)({variant:"outline"}),"mt-2 sm:mt-0",n),...s})});v.displayName=r.$j.displayName},68245:function(e,t,n){"use strict";n.d(t,{X:function(){return o}});var a=n(57437),s=n(2265),r=n(9270),i=n(30401),l=n(93448);let o=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.fC,{ref:t,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",n),...s,children:(0,a.jsx)(r.z$,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})})});o.displayName=r.fC.displayName},75060:function(e,t,n){"use strict";n.d(t,{_:function(){return c}});var a=n(57437),s=n(2265),r=n(6394),i=n(90535),l=n(93448);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.f,{ref:t,className:(0,l.cn)(o(),n),...s})});c.displayName=r.f.displayName},23675:function(e,t,n){"use strict";n.d(t,{g:function(){return i}});var a=n(57437),s=n(2265),r=n(93448);let i=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...s})});i.displayName="Textarea"},41858:function(e,t,n){"use strict";n.d(t,{BV:function(){return o},Il:function(){return l},SI:function(){return i}});var a=n(2265),s=n(99376);let r=e=>{let{shortcuts:t,enabled:n=!0}=e,s=(0,a.useCallback)(e=>{if(!n)return;let a=e.target;if("INPUT"===a.tagName||"TEXTAREA"===a.tagName||a.isContentEditable)return;let s=t.find(t=>t.key.toLowerCase()===e.key.toLowerCase()&&!!t.ctrlKey===e.ctrlKey&&!!t.altKey===e.altKey&&!!t.shiftKey===e.shiftKey);s&&(e.preventDefault(),s.action())},[t,n]);(0,a.useEffect)(()=>{if(n)return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[s,n])},i=()=>{let e=(0,s.useRouter)();r({shortcuts:[{key:"h",shiftKey:!0,altKey:!0,action:()=>e.push("/"),description:"Go to Home"},{key:"t",shiftKey:!0,altKey:!0,action:()=>e.push("/trees"),description:"Go to Trees"},{key:"n",shiftKey:!0,altKey:!0,action:()=>e.push("/notifications"),description:"Go to Notifications"},{key:"p",shiftKey:!0,altKey:!0,action:()=>e.push("/profile"),description:"Go to Profile"},{key:"/",shiftKey:!0,action:()=>{let e=document.querySelector('input[type="search"]');e&&e.focus()},description:"Focus Search"},{key:"?",shiftKey:!0,action:()=>{let e=new CustomEvent("show-shortcuts-help");document.dispatchEvent(e)},description:"Show Keyboard Shortcuts Help"}]})},l=e=>{let t=(0,s.useRouter)();r({shortcuts:[{key:"e",shiftKey:!0,altKey:!0,action:()=>{e&&t.push("/trees/".concat(e,"/events"))},description:"Go to Events"},{key:"g",shiftKey:!0,altKey:!0,action:()=>{e&&t.push("/trees/".concat(e,"/gallery"))},description:"Go to Gallery"},{key:"r",shiftKey:!0,altKey:!0,action:()=>{e&&t.push("/trees/".concat(e,"/relationships"))},description:"Go to Relationships"},{key:"m",shiftKey:!0,altKey:!0,action:()=>{e&&t.push("/trees/".concat(e,"/members"))},description:"Go to Members"},{key:"i",shiftKey:!0,altKey:!0,action:()=>{e&&t.push("/trees/".concat(e,"/invites"))},description:"Go to Invites"},{key:"Escape",action:()=>{let e=new CustomEvent("close-dialogs");document.dispatchEvent(e)},description:"Close Dialogs"}],enabled:!!e})},o=e=>{r({shortcuts:[{key:"+",shiftKey:!0,action:e.zoomIn,description:"Zoom In"},{key:"_",shiftKey:!0,action:e.zoomOut,description:"Zoom Out"},{key:"0",shiftKey:!0,action:e.resetZoom,description:"Reset Zoom"},{key:"c",shiftKey:!0,altKey:!0,action:e.centerView,description:"Center View"},{key:"f",shiftKey:!0,action:()=>{e.toggleFullscreen&&e.toggleFullscreen()},description:"Toggle Fullscreen"},{key:"l",shiftKey:!0,altKey:!0,action:()=>{e.traceLineage&&e.traceLineage()},description:"Trace Selected Member Lineage"},{key:"h",shiftKey:!0,action:()=>{e.showHelp&&e.showHelp()},description:"Show Tree Navigation Help"}]})}}},function(e){e.O(0,[922,7697,1770,7203,4360,8269,985,7930,4713,7308,7117,6951,2971,2117,1744],function(){return e(e.s=44542)}),_N_E=e.O()}]);