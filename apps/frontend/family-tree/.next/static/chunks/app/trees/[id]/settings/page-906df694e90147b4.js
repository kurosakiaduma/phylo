(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1509],{95081:function(e,s,t){Promise.resolve().then(t.bind(t,63779))},63779:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return F}});var a=t(57437),n=t(2265),l=t(99376),r=t(12381),i=t(40279),o=t(75060),c=t(79820),d=t(86271),m=t(23340),u=t(88906),f=t(32660),x=t(15863),h=t(33245),p=t(63639),g=t(83229),j=t(94589),v=t(31593),y=t(90535),w=t(93448);let N=(0,y.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),b=n.forwardRef((e,s)=>{let{className:t,variant:n,...l}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:(0,w.cn)(N({variant:n}),t),...l})});b.displayName="Alert";let _=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("h5",{ref:s,className:(0,w.cn)("mb-1 font-medium leading-none tracking-tight",t),...n})});_.displayName="AlertTitle";let k=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,w.cn)("text-sm [&_p]:leading-relaxed",t),...n})});k.displayName="AlertDescription";var C=t(68245),S=t(74291);function F(){let e=(0,l.useParams)(),s=(0,l.useRouter)(),{toast:t}=(0,m.pm)(),y=e.id,[w,N]=(0,n.useState)(null),[F,Z]=(0,n.useState)({allow_same_sex:!0,monogamy:!0,allow_polygamy:!1,allow_single_parent:!0,allow_multi_parent_children:!1,max_parents_per_child:2}),[E,T]=(0,n.useState)(null),[z,R]=(0,n.useState)(null),[A,P]=(0,n.useState)(!1),[O,D]=(0,n.useState)(!1),[I,V]=(0,n.useState)(!0),[M,B]=(0,n.useState)(!1),[J,U]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{(async()=>{try{var e,a,n,l,r,i;let s=await fetch("".concat("http://localhost:8050/api","/trees/").concat(y),{credentials:"include"});if(!s.ok)throw Error("Failed to fetch tree details");let t=await s.json();N(t);let o={allow_same_sex:null===(e=t.settings.allowSameSex)||void 0===e||e,monogamy:null===(a=t.settings.monogamy)||void 0===a||a,allow_polygamy:null!==(n=t.settings.allowPolygamy)&&void 0!==n&&n,allow_single_parent:null===(l=t.settings.allowSingleParent)||void 0===l||l,allow_multi_parent_children:null!==(r=t.settings.allowMultiParentChildren)&&void 0!==r&&r,max_parents_per_child:null!==(i=t.settings.maxParentsPerChild)&&void 0!==i?i:2,max_spouses_per_member:t.settings.maxSpousesPerMember};Z(o),T(o)}catch(e){console.error("Error fetching tree:",e),t({title:"Error",description:"Failed to load tree settings",variant:"destructive"}),s.push("/trees/".concat(y))}finally{V(!1)}})()},[y,s,t]),w&&"custodian"!==w.user_role)return(0,a.jsx)(d.c,{children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto space-y-6",children:[(0,a.jsxs)(b,{variant:"destructive",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsx)(_,{children:"Access Denied"}),(0,a.jsx)(k,{children:"Only custodians can modify tree settings."})]}),(0,a.jsxs)(r.z,{onClick:()=>s.push("/trees/".concat(y)),children:[(0,a.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Back to Tree"]})]})});let Y=E&&JSON.stringify(F)!==JSON.stringify(E),$=(e,s)=>{Z(t=>({...t,[e]:s})),R(null)},q=async()=>{try{U(!0);let e=await fetch("".concat("http://localhost:8050/api","/trees/").concat(y,"/settings/preview"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(F)});if(!e.ok)throw Error("Failed to preview settings impact");let s=await e.json();R(s),s.would_violate?t({title:"Warning",description:"These settings would affect ".concat(s.affected_relationships," relationship(s)"),variant:"destructive"}):t({title:"No conflicts",description:"These settings can be applied without issues"})}catch(e){console.error("Error previewing settings:",e),t({title:"Error",description:"Failed to preview settings impact",variant:"destructive"})}finally{U(!1)}},H=async()=>{if((null==z?void 0:z.would_violate)&&!A){D(!0);return}try{B(!0);let e=await fetch("".concat("http://localhost:8050/api","/trees/").concat(y).concat(A?"?force=true":""),{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({settings:F})});if(!e.ok){let s=await e.json();throw Error(s.detail||"Failed to update settings")}t({title:"Success",description:"Tree settings updated successfully"}),D(!1),P(!1),R(null),T(F),s.refresh()}catch(e){console.error("Error updating settings:",e),t({title:"Error",description:e instanceof Error?e.message:"Failed to update settings",variant:"destructive"})}finally{B(!1)}};return I?(0,a.jsx)(d.c,{children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsx)(x.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):w?(0,a.jsx)(d.c,{children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Tree Settings"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:w.name})]}),(0,a.jsxs)(r.z,{variant:"ghost",onClick:()=>s.push("/trees/".concat(y)),children:[(0,a.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Back"]})]}),(0,a.jsxs)(b,{children:[(0,a.jsx)(h.Z,{className:"h-4 w-4"}),(0,a.jsx)(_,{children:"About Tree Settings"}),(0,a.jsx)(k,{children:"These settings control what types of relationships and family structures are allowed in your tree. Changes may affect existing relationships."})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsxs)(c.Ol,{children:[(0,a.jsx)(c.ll,{children:"Relationship Settings"}),(0,a.jsx)(c.SZ,{children:"Configure the rules for your family tree"})]}),(0,a.jsxs)(c.aY,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(o._,{htmlFor:"allow_same_sex",className:"text-base font-medium",children:"Allow same-sex relationships"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Enable relationships between members of the same gender"})]}),(0,a.jsx)(j.r,{id:"allow_same_sex",checked:F.allow_same_sex,onCheckedChange:e=>$("allow_same_sex",e)})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(o._,{htmlFor:"monogamy",className:"text-base font-medium",children:"Enforce monogamy"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Members can only have one spouse at a time"})]}),(0,a.jsx)(j.r,{id:"monogamy",checked:F.monogamy,onCheckedChange:e=>{$("monogamy",e),e&&($("allow_polygamy",!1),$("max_spouses_per_member",void 0))}})]}),!F.monogamy&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between space-x-4 pl-6",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(o._,{htmlFor:"allow_polygamy",className:"text-base font-medium",children:"Allow polygamy"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Members can have multiple spouses simultaneously"})]}),(0,a.jsx)(j.r,{id:"allow_polygamy",checked:F.allow_polygamy,onCheckedChange:e=>$("allow_polygamy",e)})]}),F.allow_polygamy&&(0,a.jsxs)("div",{className:"pl-6 space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"max_spouses",className:"text-sm font-medium",children:"Maximum spouses per member (optional)"}),(0,a.jsx)(i.I,{id:"max_spouses",type:"number",min:"2",max:"10",placeholder:"No limit",value:F.max_spouses_per_member||"",onChange:e=>$("max_spouses_per_member",e.target.value?parseInt(e.target.value):void 0),className:"max-w-[200px]"})]})]})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(o._,{htmlFor:"allow_single_parent",className:"text-base font-medium",children:"Allow single parent children"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Children can have only one listed parent"})]}),(0,a.jsx)(j.r,{id:"allow_single_parent",checked:F.allow_single_parent,onCheckedChange:e=>$("allow_single_parent",e)})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(o._,{htmlFor:"allow_multi_parent",className:"text-base font-medium",children:"Allow multi-parent children"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Children can have more than 2 parents"})]}),(0,a.jsx)(j.r,{id:"allow_multi_parent",checked:F.allow_multi_parent_children,onCheckedChange:e=>$("allow_multi_parent_children",e)})]}),F.allow_multi_parent_children&&(0,a.jsxs)("div",{className:"pl-6 space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"max_parents",className:"text-sm font-medium",children:"Maximum parents per child"}),(0,a.jsx)(i.I,{id:"max_parents",type:"number",min:"3",max:"10",value:F.max_parents_per_child,onChange:e=>$("max_parents_per_child",parseInt(e.target.value)||2),className:"max-w-[200px]"})]})]})]})]}),z&&z.would_violate&&(0,a.jsxs)(b,{variant:"destructive",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),(0,a.jsx)(_,{children:"Settings Conflict Detected"}),(0,a.jsxs)(k,{children:[(0,a.jsxs)("p",{className:"mb-2",children:["These settings would affect"," ",z.affected_relationships," relationship(s) involving"," ",z.affected_members," member(s):"]}),(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1 text-sm",children:z.violations.map((e,s)=>(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:e.member_name}),": ",e.issue]},s))}),(0,a.jsxs)("div",{className:"mt-4 flex items-center space-x-2",children:[(0,a.jsx)(C.X,{id:"force_update",checked:A,onCheckedChange:e=>P(e)}),(0,a.jsx)("label",{htmlFor:"force_update",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Force update and remove conflicting relationships"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)(r.z,{onClick:q,disabled:!Y||J,variant:"outline",className:"flex-1",children:J?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Checking..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Preview Impact"]})}),(0,a.jsx)(r.z,{onClick:H,disabled:!Y||M,className:"flex-1",children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]}),(0,a.jsx)(S.Vq,{open:O,onOpenChange:D,children:(0,a.jsxs)(S.cZ,{children:[(0,a.jsxs)(S.fK,{children:[(0,a.jsx)(S.$N,{children:"Confirm Settings Update"}),(0,a.jsx)(S.Be,{children:A?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"font-semibold text-destructive",children:"Warning: Force update will remove conflicting relationships!"}),(0,a.jsxs)("p",{children:["This action will permanently delete"," ",null==z?void 0:z.affected_relationships," relationship(s) that violate the new settings. This cannot be undone."]})]}):(0,a.jsx)("p",{children:"Are you sure you want to update the tree settings? This may affect existing relationships."})})]}),(0,a.jsxs)(S.cN,{children:[(0,a.jsx)(r.z,{variant:"outline",onClick:()=>D(!1),disabled:M,children:"Cancel"}),(0,a.jsx)(r.z,{onClick:H,disabled:M,variant:A?"destructive":"default",children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Confirm Update"})]})]})})]})}):null}},68245:function(e,s,t){"use strict";t.d(s,{X:function(){return o}});var a=t(57437),n=t(2265),l=t(9270),r=t(30401),i=t(93448);let o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.fC,{ref:s,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...n,children:(0,a.jsx)(l.z$,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(r.Z,{className:"h-4 w-4"})})})});o.displayName=l.fC.displayName},74291:function(e,s,t){"use strict";t.d(s,{$N:function(){return h},Be:function(){return p},Vq:function(){return o},cN:function(){return x},cZ:function(){return u},fK:function(){return f},hg:function(){return c}});var a=t(57437),n=t(2265),l=t(49027),r=t(32489),i=t(93448);let o=l.fC,c=l.xz,d=l.h_;l.x8;let m=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.aV,{ref:s,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n})});m.displayName=l.aV.displayName;let u=n.forwardRef((e,s)=>{let{className:t,children:n,...o}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(m,{}),(0,a.jsxs)(l.VY,{ref:s,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...o,children:[n,(0,a.jsxs)(l.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(r.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=l.VY.displayName;let f=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};f.displayName="DialogHeader";let x=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};x.displayName="DialogFooter";let h=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.Dx,{ref:s,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...n})});h.displayName=l.Dx.displayName;let p=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.dk,{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",t),...n})});p.displayName=l.dk.displayName},40279:function(e,s,t){"use strict";t.d(s,{I:function(){return r}});var a=t(57437),n=t(2265),l=t(93448);let r=n.forwardRef((e,s)=>{let{className:t,type:n,...r}=e;return(0,a.jsx)("input",{type:n,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...r})});r.displayName="Input"},75060:function(e,s,t){"use strict";t.d(s,{_:function(){return c}});var a=t(57437),n=t(2265),l=t(6394),r=t(90535),i=t(93448);let o=(0,r.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.f,{ref:s,className:(0,i.cn)(o(),t),...n})});c.displayName=l.f.displayName},31593:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var a=t(57437),n=t(2265),l=t(55156),r=t(93448);let i=n.forwardRef((e,s)=>{let{className:t,orientation:n="horizontal",decorative:i=!0,...o}=e;return(0,a.jsx)(l.f,{ref:s,decorative:i,orientation:n,className:(0,r.cn)("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",t),...o})});i.displayName=l.f.displayName},94589:function(e,s,t){"use strict";t.d(s,{r:function(){return i}});var a=t(57437),n=t(2265),l=t(50721),r=t(93448);let i=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.fC,{className:(0,r.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...n,ref:s,children:(0,a.jsx)(l.bU,{className:(0,r.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});i.displayName=l.fC.displayName}},function(e){e.O(0,[7697,1770,7203,4360,4220,4713,7308,2971,2117,1744],function(){return e(e.s=95081)}),_N_E=e.O()}]);